var __extends=this&&this.__extends||function(){var t=function(i,r){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r))t[r]=i[r]};return t(i,r)};return function(i,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(i,r);function e(){this.constructor=i}i.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}}();var __awaiter=this&&this.__awaiter||function(t,i,r,e){function n(t){return t instanceof r?t:new r((function(i){i(t)}))}return new(r||(r=Promise))((function(r,f){function s(t){try{o(e.next(t))}catch(t){f(t)}}function u(t){try{o(e["throw"](t))}catch(t){f(t)}}function o(t){t.done?r(t.value):n(t.value).then(s,u)}o((e=e.apply(t,i||[])).next())}))};var __generator=this&&this.__generator||function(t,i){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},e,n,f,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(t){return function(i){return o([t,i])}}function o(u){if(e)throw new TypeError("Generator is already executing.");while(s&&(s=0,u[0]&&(r=0)),r)try{if(e=1,n&&(f=u[0]&2?n["return"]:u[0]?n["throw"]||((f=n["return"])&&f.call(n),0):n.next)&&!(f=f.call(n,u[1])).done)return f;if(n=0,f)u=[u[0]&2,f.value];switch(u[0]){case 0:case 1:f=u;break;case 4:r.label++;return{value:u[1],done:false};case 5:r.label++;n=u[1];u=[0];continue;case 7:u=r.ops.pop();r.trys.pop();continue;default:if(!(f=r.trys,f=f.length>0&&f[f.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!f||u[1]>f[0]&&u[1]<f[3])){r.label=u[1];break}if(u[0]===6&&r.label<f[1]){r.label=f[1];f=u;break}if(f&&r.label<f[2]){r.label=f[2];r.ops.push(u);break}if(f[2])r.ops.pop();r.trys.pop();continue}u=i.call(t,r)}catch(t){u=[6,t];n=0}finally{e=f=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(t,i,r){if(r||arguments.length===2)for(var e=0,n=i.length,f;e<n;e++){if(f||!(e in i)){if(!f)f=Array.prototype.slice.call(i,0,e);f[e]=i[e]}}return t.concat(f||Array.prototype.slice.call(i))};System.register(["./p-3b944dd6.system.js"],(function(t){"use strict";var i,r,e,n,f;return{setters:[function(t){i=t.h;r=t.r;e=t.c;n=t.g;f=t.H}],execute:function(){var s=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var u=[];var o=[];var a=typeof Uint8Array!=="undefined"?Uint8Array:Array;var h=false;function c(){h=true;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,r=t.length;i<r;++i){u[i]=t[i];o[t.charCodeAt(i)]=i}o["-".charCodeAt(0)]=62;o["_".charCodeAt(0)]=63}function v(t){if(!h){c()}var i,r,e,n,f,s;var u=t.length;if(u%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}f=t[u-2]==="="?2:t[u-1]==="="?1:0;s=new a(u*3/4-f);e=f>0?u-4:u;var v=0;for(i=0,r=0;i<e;i+=4,r+=3){n=o[t.charCodeAt(i)]<<18|o[t.charCodeAt(i+1)]<<12|o[t.charCodeAt(i+2)]<<6|o[t.charCodeAt(i+3)];s[v++]=n>>16&255;s[v++]=n>>8&255;s[v++]=n&255}if(f===2){n=o[t.charCodeAt(i)]<<2|o[t.charCodeAt(i+1)]>>4;s[v++]=n&255}else if(f===1){n=o[t.charCodeAt(i)]<<10|o[t.charCodeAt(i+1)]<<4|o[t.charCodeAt(i+2)]>>2;s[v++]=n>>8&255;s[v++]=n&255}return s}function l(t){return u[t>>18&63]+u[t>>12&63]+u[t>>6&63]+u[t&63]}function d(t,i,r){var e;var n=[];for(var f=i;f<r;f+=3){e=(t[f]<<16)+(t[f+1]<<8)+t[f+2];n.push(l(e))}return n.join("")}function b(t){if(!h){c()}var i;var r=t.length;var e=r%3;var n="";var f=[];var s=16383;for(var o=0,a=r-e;o<a;o+=s){f.push(d(t,o,o+s>a?a:o+s))}if(e===1){i=t[r-1];n+=u[i>>2];n+=u[i<<4&63];n+="=="}else if(e===2){i=(t[r-2]<<8)+t[r-1];n+=u[i>>10];n+=u[i>>4&63];n+=u[i<<2&63];n+="="}f.push(n);return f.join("")}function w(t,i,r,e,n){var f,s;var u=n*8-e-1;var o=(1<<u)-1;var a=o>>1;var h=-7;var c=r?n-1:0;var v=r?-1:1;var l=t[i+c];c+=v;f=l&(1<<-h)-1;l>>=-h;h+=u;for(;h>0;f=f*256+t[i+c],c+=v,h-=8){}s=f&(1<<-h)-1;f>>=-h;h+=e;for(;h>0;s=s*256+t[i+c],c+=v,h-=8){}if(f===0){f=1-a}else if(f===o){return s?NaN:(l?-1:1)*Infinity}else{s=s+Math.pow(2,e);f=f-a}return(l?-1:1)*s*Math.pow(2,f-e)}function y(t,i,r,e,n,f){var s,u,o;var a=f*8-n-1;var h=(1<<a)-1;var c=h>>1;var v=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var l=e?0:f-1;var d=e?1:-1;var b=i<0||i===0&&1/i<0?1:0;i=Math.abs(i);if(isNaN(i)||i===Infinity){u=isNaN(i)?1:0;s=h}else{s=Math.floor(Math.log(i)/Math.LN2);if(i*(o=Math.pow(2,-s))<1){s--;o*=2}if(s+c>=1){i+=v/o}else{i+=v*Math.pow(2,1-c)}if(i*o>=2){s++;o/=2}if(s+c>=h){u=0;s=h}else if(s+c>=1){u=(i*o-1)*Math.pow(2,n);s=s+c}else{u=i*Math.pow(2,c-1)*Math.pow(2,n);s=0}}for(;n>=8;t[r+l]=u&255,l+=d,u/=256,n-=8){}s=s<<n|u;a+=n;for(;a>0;t[r+l]=s&255,l+=d,s/=256,a-=8){}t[r+l-d]|=b*128}var g={}.toString;var p=Array.isArray||function(t){return g.call(t)=="[object Array]"};
/*!
       * The buffer module from node.js, for the browser.
       *
       * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
       * @license  MIT
       */var m=50;k.TYPED_ARRAY_SUPPORT=s.TYPED_ARRAY_SUPPORT!==undefined?s.TYPED_ARRAY_SUPPORT:true;function _(){return k.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function E(t,i){if(_()<i){throw new RangeError("Invalid typed array length")}if(k.TYPED_ARRAY_SUPPORT){t=new Uint8Array(i);t.__proto__=k.prototype}else{if(t===null){t=new k(i)}t.length=i}return t}function k(t,i,r){if(!k.TYPED_ARRAY_SUPPORT&&!(this instanceof k)){return new k(t,i,r)}if(typeof t==="number"){if(typeof i==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return M(this,t)}return A(this,t,i,r)}k.poolSize=8192;k._augment=function(t){t.__proto__=k.prototype;return t};function A(t,i,r,e){if(typeof i==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&i instanceof ArrayBuffer){return U(t,i,r,e)}if(typeof i==="string"){return B(t,i,r)}return j(t,i)}k.from=function(t,i,r){return A(null,t,i,r)};if(k.TYPED_ARRAY_SUPPORT){k.prototype.__proto__=Uint8Array.prototype;k.__proto__=Uint8Array}function $(t){if(typeof t!=="number"){throw new TypeError('"size" argument must be a number')}else if(t<0){throw new RangeError('"size" argument must not be negative')}}function x(t,i,r,e){$(i);if(i<=0){return E(t,i)}if(r!==undefined){return typeof e==="string"?E(t,i).fill(r,e):E(t,i).fill(r)}return E(t,i)}k.alloc=function(t,i,r){return x(null,t,i,r)};function M(t,i){$(i);t=E(t,i<0?0:T(i)|0);if(!k.TYPED_ARRAY_SUPPORT){for(var r=0;r<i;++r){t[r]=0}}return t}k.allocUnsafe=function(t){return M(null,t)};k.allocUnsafeSlow=function(t){return M(null,t)};function B(t,i,r){if(typeof r!=="string"||r===""){r="utf8"}if(!k.isEncoding(r)){throw new TypeError('"encoding" must be a valid string encoding')}var e=O(i,r)|0;t=E(t,e);var n=t.write(i,r);if(n!==e){t=t.slice(0,n)}return t}function N(t,i){var r=i.length<0?0:T(i.length)|0;t=E(t,r);for(var e=0;e<r;e+=1){t[e]=i[e]&255}return t}function U(t,i,r,e){if(r<0||i.byteLength<r){throw new RangeError("'offset' is out of bounds")}if(i.byteLength<r+(e||0)){throw new RangeError("'length' is out of bounds")}if(r===undefined&&e===undefined){i=new Uint8Array(i)}else if(e===undefined){i=new Uint8Array(i,r)}else{i=new Uint8Array(i,r,e)}if(k.TYPED_ARRAY_SUPPORT){t=i;t.__proto__=k.prototype}else{t=N(t,i)}return t}function j(t,i){if(I(i)){var r=T(i.length)|0;t=E(t,r);if(t.length===0){return t}i.copy(t,0,0,r);return t}if(i){if(typeof ArrayBuffer!=="undefined"&&i.buffer instanceof ArrayBuffer||"length"in i){if(typeof i.length!=="number"||bt(i.length)){return E(t,0)}return N(t,i)}if(i.type==="Buffer"&&p(i.data)){return N(t,i.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function T(t){if(t>=_()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+_().toString(16)+" bytes")}return t|0}k.isBuffer=wt;function I(t){return!!(t!=null&&t._isBuffer)}k.compare=function t(i,r){if(!I(i)||!I(r)){throw new TypeError("Arguments must be Buffers")}if(i===r)return 0;var e=i.length;var n=r.length;for(var f=0,s=Math.min(e,n);f<s;++f){if(i[f]!==r[f]){e=i[f];n=r[f];break}}if(e<n)return-1;if(n<e)return 1;return 0};k.isEncoding=function t(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};k.concat=function t(i,r){if(!p(i)){throw new TypeError('"list" argument must be an Array of Buffers')}if(i.length===0){return k.alloc(0)}var e;if(r===undefined){r=0;for(e=0;e<i.length;++e){r+=i[e].length}}var n=k.allocUnsafe(r);var f=0;for(e=0;e<i.length;++e){var s=i[e];if(!I(s)){throw new TypeError('"list" argument must be an Array of Buffers')}s.copy(n,f);f+=s.length}return n};function O(t,i){if(I(t)){return t.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)){return t.byteLength}if(typeof t!=="string"){t=""+t}var r=t.length;if(r===0)return 0;var e=false;for(;;){switch(i){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case undefined:return ht(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return lt(t).length;default:if(e)return ht(t).length;i=(""+i).toLowerCase();e=true}}}k.byteLength=O;function R(t,i,r){var e=false;if(i===undefined||i<0){i=0}if(i>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;i>>>=0;if(r<=i){return""}if(!t)t="utf8";while(true){switch(t){case"hex":return W(this,i,r);case"utf8":case"utf-8":return L(this,i,r);case"ascii":return K(this,i,r);case"latin1":case"binary":return Q(this,i,r);case"base64":return G(this,i,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,i,r);default:if(e)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase();e=true}}}k.prototype._isBuffer=true;function S(t,i,r){var e=t[i];t[i]=t[r];t[r]=e}k.prototype.swap16=function t(){var i=this.length;if(i%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<i;r+=2){S(this,r,r+1)}return this};k.prototype.swap32=function t(){var i=this.length;if(i%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<i;r+=4){S(this,r,r+3);S(this,r+1,r+2)}return this};k.prototype.swap64=function t(){var i=this.length;if(i%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<i;r+=8){S(this,r,r+7);S(this,r+1,r+6);S(this,r+2,r+5);S(this,r+3,r+4)}return this};k.prototype.toString=function t(){var i=this.length|0;if(i===0)return"";if(arguments.length===0)return L(this,0,i);return R.apply(this,arguments)};k.prototype.equals=function t(i){if(!I(i))throw new TypeError("Argument must be a Buffer");if(this===i)return true;return k.compare(this,i)===0};k.prototype.inspect=function t(){var i="";var r=m;if(this.length>0){i=this.toString("hex",0,r).match(/.{2}/g).join(" ");if(this.length>r)i+=" ... "}return"<Buffer "+i+">"};k.prototype.compare=function t(i,r,e,n,f){if(!I(i)){throw new TypeError("Argument must be a Buffer")}if(r===undefined){r=0}if(e===undefined){e=i?i.length:0}if(n===undefined){n=0}if(f===undefined){f=this.length}if(r<0||e>i.length||n<0||f>this.length){throw new RangeError("out of range index")}if(n>=f&&r>=e){return 0}if(n>=f){return-1}if(r>=e){return 1}r>>>=0;e>>>=0;n>>>=0;f>>>=0;if(this===i)return 0;var s=f-n;var u=e-r;var o=Math.min(s,u);var a=this.slice(n,f);var h=i.slice(r,e);for(var c=0;c<o;++c){if(a[c]!==h[c]){s=a[c];u=h[c];break}}if(s<u)return-1;if(u<s)return 1;return 0};function V(t,i,r,e,n){if(t.length===0)return-1;if(typeof r==="string"){e=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(isNaN(r)){r=n?0:t.length-1}if(r<0)r=t.length+r;if(r>=t.length){if(n)return-1;else r=t.length-1}else if(r<0){if(n)r=0;else return-1}if(typeof i==="string"){i=k.from(i,e)}if(I(i)){if(i.length===0){return-1}return F(t,i,r,e,n)}else if(typeof i==="number"){i=i&255;if(k.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(t,i,r)}else{return Uint8Array.prototype.lastIndexOf.call(t,i,r)}}return F(t,[i],r,e,n)}throw new TypeError("val must be string, number or Buffer")}function F(t,i,r,e,n){var f=1;var s=t.length;var u=i.length;if(e!==undefined){e=String(e).toLowerCase();if(e==="ucs2"||e==="ucs-2"||e==="utf16le"||e==="utf-16le"){if(t.length<2||i.length<2){return-1}f=2;s/=2;u/=2;r/=2}}function o(t,i){if(f===1){return t[i]}else{return t.readUInt16BE(i*f)}}var a;if(n){var h=-1;for(a=r;a<s;a++){if(o(t,a)===o(i,h===-1?0:a-h)){if(h===-1)h=a;if(a-h+1===u)return h*f}else{if(h!==-1)a-=a-h;h=-1}}}else{if(r+u>s)r=s-u;for(a=r;a>=0;a--){var c=true;for(var v=0;v<u;v++){if(o(t,a+v)!==o(i,v)){c=false;break}}if(c)return a}}return-1}k.prototype.includes=function t(i,r,e){return this.indexOf(i,r,e)!==-1};k.prototype.indexOf=function t(i,r,e){return V(this,i,r,e,true)};k.prototype.lastIndexOf=function t(i,r,e){return V(this,i,r,e,false)};function D(t,i,r,e){r=Number(r)||0;var n=t.length-r;if(!e){e=n}else{e=Number(e);if(e>n){e=n}}var f=i.length;if(f%2!==0)throw new TypeError("Invalid hex string");if(e>f/2){e=f/2}for(var s=0;s<e;++s){var u=parseInt(i.substr(s*2,2),16);if(isNaN(u))return s;t[r+s]=u}return s}function q(t,i,r,e){return dt(ht(i,t.length-r),t,r,e)}function z(t,i,r,e){return dt(ct(i),t,r,e)}function C(t,i,r,e){return z(t,i,r,e)}function P(t,i,r,e){return dt(lt(i),t,r,e)}function J(t,i,r,e){return dt(vt(i,t.length-r),t,r,e)}k.prototype.write=function t(i,r,e,n){if(r===undefined){n="utf8";e=this.length;r=0}else if(e===undefined&&typeof r==="string"){n=r;e=this.length;r=0}else if(isFinite(r)){r=r|0;if(isFinite(e)){e=e|0;if(n===undefined)n="utf8"}else{n=e;e=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var f=this.length-r;if(e===undefined||e>f)e=f;if(i.length>0&&(e<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var s=false;for(;;){switch(n){case"hex":return D(this,i,r,e);case"utf8":case"utf-8":return q(this,i,r,e);case"ascii":return z(this,i,r,e);case"latin1":case"binary":return C(this,i,r,e);case"base64":return P(this,i,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return J(this,i,r,e);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();s=true}}};k.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(t,i,r){if(i===0&&r===t.length){return b(t)}else{return b(t.slice(i,r))}}function L(t,i,r){r=Math.min(t.length,r);var e=[];var n=i;while(n<r){var f=t[n];var s=null;var u=f>239?4:f>223?3:f>191?2:1;if(n+u<=r){var o,a,h,c;switch(u){case 1:if(f<128){s=f}break;case 2:o=t[n+1];if((o&192)===128){c=(f&31)<<6|o&63;if(c>127){s=c}}break;case 3:o=t[n+1];a=t[n+2];if((o&192)===128&&(a&192)===128){c=(f&15)<<12|(o&63)<<6|a&63;if(c>2047&&(c<55296||c>57343)){s=c}}break;case 4:o=t[n+1];a=t[n+2];h=t[n+3];if((o&192)===128&&(a&192)===128&&(h&192)===128){c=(f&15)<<18|(o&63)<<12|(a&63)<<6|h&63;if(c>65535&&c<1114112){s=c}}}}if(s===null){s=65533;u=1}else if(s>65535){s-=65536;e.push(s>>>10&1023|55296);s=56320|s&1023}e.push(s);n+=u}return H(e)}var Z=4096;function H(t){var i=t.length;if(i<=Z){return String.fromCharCode.apply(String,t)}var r="";var e=0;while(e<i){r+=String.fromCharCode.apply(String,t.slice(e,e+=Z))}return r}function K(t,i,r){var e="";r=Math.min(t.length,r);for(var n=i;n<r;++n){e+=String.fromCharCode(t[n]&127)}return e}function Q(t,i,r){var e="";r=Math.min(t.length,r);for(var n=i;n<r;++n){e+=String.fromCharCode(t[n])}return e}function W(t,i,r){var e=t.length;if(!i||i<0)i=0;if(!r||r<0||r>e)r=e;var n="";for(var f=i;f<r;++f){n+=at(t[f])}return n}function X(t,i,r){var e=t.slice(i,r);var n="";for(var f=0;f<e.length;f+=2){n+=String.fromCharCode(e[f]+e[f+1]*256)}return n}k.prototype.slice=function t(i,r){var e=this.length;i=~~i;r=r===undefined?e:~~r;if(i<0){i+=e;if(i<0)i=0}else if(i>e){i=e}if(r<0){r+=e;if(r<0)r=0}else if(r>e){r=e}if(r<i)r=i;var n;if(k.TYPED_ARRAY_SUPPORT){n=this.subarray(i,r);n.__proto__=k.prototype}else{var f=r-i;n=new k(f,undefined);for(var s=0;s<f;++s){n[s]=this[s+i]}}return n};function Y(t,i,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+i>r)throw new RangeError("Trying to access beyond buffer length")}k.prototype.readUIntLE=function t(i,r,e){i=i|0;r=r|0;if(!e)Y(i,r,this.length);var n=this[i];var f=1;var s=0;while(++s<r&&(f*=256)){n+=this[i+s]*f}return n};k.prototype.readUIntBE=function t(i,r,e){i=i|0;r=r|0;if(!e){Y(i,r,this.length)}var n=this[i+--r];var f=1;while(r>0&&(f*=256)){n+=this[i+--r]*f}return n};k.prototype.readUInt8=function t(i,r){if(!r)Y(i,1,this.length);return this[i]};k.prototype.readUInt16LE=function t(i,r){if(!r)Y(i,2,this.length);return this[i]|this[i+1]<<8};k.prototype.readUInt16BE=function t(i,r){if(!r)Y(i,2,this.length);return this[i]<<8|this[i+1]};k.prototype.readUInt32LE=function t(i,r){if(!r)Y(i,4,this.length);return(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216};k.prototype.readUInt32BE=function t(i,r){if(!r)Y(i,4,this.length);return this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])};k.prototype.readIntLE=function t(i,r,e){i=i|0;r=r|0;if(!e)Y(i,r,this.length);var n=this[i];var f=1;var s=0;while(++s<r&&(f*=256)){n+=this[i+s]*f}f*=128;if(n>=f)n-=Math.pow(2,8*r);return n};k.prototype.readIntBE=function t(i,r,e){i=i|0;r=r|0;if(!e)Y(i,r,this.length);var n=r;var f=1;var s=this[i+--n];while(n>0&&(f*=256)){s+=this[i+--n]*f}f*=128;if(s>=f)s-=Math.pow(2,8*r);return s};k.prototype.readInt8=function t(i,r){if(!r)Y(i,1,this.length);if(!(this[i]&128))return this[i];return(255-this[i]+1)*-1};k.prototype.readInt16LE=function t(i,r){if(!r)Y(i,2,this.length);var e=this[i]|this[i+1]<<8;return e&32768?e|4294901760:e};k.prototype.readInt16BE=function t(i,r){if(!r)Y(i,2,this.length);var e=this[i+1]|this[i]<<8;return e&32768?e|4294901760:e};k.prototype.readInt32LE=function t(i,r){if(!r)Y(i,4,this.length);return this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24};k.prototype.readInt32BE=function t(i,r){if(!r)Y(i,4,this.length);return this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]};k.prototype.readFloatLE=function t(i,r){if(!r)Y(i,4,this.length);return w(this,i,true,23,4)};k.prototype.readFloatBE=function t(i,r){if(!r)Y(i,4,this.length);return w(this,i,false,23,4)};k.prototype.readDoubleLE=function t(i,r){if(!r)Y(i,8,this.length);return w(this,i,true,52,8)};k.prototype.readDoubleBE=function t(i,r){if(!r)Y(i,8,this.length);return w(this,i,false,52,8)};function tt(t,i,r,e,n,f){if(!I(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>n||i<f)throw new RangeError('"value" argument is out of bounds');if(r+e>t.length)throw new RangeError("Index out of range")}k.prototype.writeUIntLE=function t(i,r,e,n){i=+i;r=r|0;e=e|0;if(!n){var f=Math.pow(2,8*e)-1;tt(this,i,r,e,f,0)}var s=1;var u=0;this[r]=i&255;while(++u<e&&(s*=256)){this[r+u]=i/s&255}return r+e};k.prototype.writeUIntBE=function t(i,r,e,n){i=+i;r=r|0;e=e|0;if(!n){var f=Math.pow(2,8*e)-1;tt(this,i,r,e,f,0)}var s=e-1;var u=1;this[r+s]=i&255;while(--s>=0&&(u*=256)){this[r+s]=i/u&255}return r+e};k.prototype.writeUInt8=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,1,255,0);if(!k.TYPED_ARRAY_SUPPORT)i=Math.floor(i);this[r]=i&255;return r+1};function it(t,i,r,e){if(i<0)i=65535+i+1;for(var n=0,f=Math.min(t.length-r,2);n<f;++n){t[r+n]=(i&255<<8*(e?n:1-n))>>>(e?n:1-n)*8}}k.prototype.writeUInt16LE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,2,65535,0);if(k.TYPED_ARRAY_SUPPORT){this[r]=i&255;this[r+1]=i>>>8}else{it(this,i,r,true)}return r+2};k.prototype.writeUInt16BE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,2,65535,0);if(k.TYPED_ARRAY_SUPPORT){this[r]=i>>>8;this[r+1]=i&255}else{it(this,i,r,false)}return r+2};function rt(t,i,r,e){if(i<0)i=4294967295+i+1;for(var n=0,f=Math.min(t.length-r,4);n<f;++n){t[r+n]=i>>>(e?n:3-n)*8&255}}k.prototype.writeUInt32LE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,4,4294967295,0);if(k.TYPED_ARRAY_SUPPORT){this[r+3]=i>>>24;this[r+2]=i>>>16;this[r+1]=i>>>8;this[r]=i&255}else{rt(this,i,r,true)}return r+4};k.prototype.writeUInt32BE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,4,4294967295,0);if(k.TYPED_ARRAY_SUPPORT){this[r]=i>>>24;this[r+1]=i>>>16;this[r+2]=i>>>8;this[r+3]=i&255}else{rt(this,i,r,false)}return r+4};k.prototype.writeIntLE=function t(i,r,e,n){i=+i;r=r|0;if(!n){var f=Math.pow(2,8*e-1);tt(this,i,r,e,f-1,-f)}var s=0;var u=1;var o=0;this[r]=i&255;while(++s<e&&(u*=256)){if(i<0&&o===0&&this[r+s-1]!==0){o=1}this[r+s]=(i/u>>0)-o&255}return r+e};k.prototype.writeIntBE=function t(i,r,e,n){i=+i;r=r|0;if(!n){var f=Math.pow(2,8*e-1);tt(this,i,r,e,f-1,-f)}var s=e-1;var u=1;var o=0;this[r+s]=i&255;while(--s>=0&&(u*=256)){if(i<0&&o===0&&this[r+s+1]!==0){o=1}this[r+s]=(i/u>>0)-o&255}return r+e};k.prototype.writeInt8=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,1,127,-128);if(!k.TYPED_ARRAY_SUPPORT)i=Math.floor(i);if(i<0)i=255+i+1;this[r]=i&255;return r+1};k.prototype.writeInt16LE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,2,32767,-32768);if(k.TYPED_ARRAY_SUPPORT){this[r]=i&255;this[r+1]=i>>>8}else{it(this,i,r,true)}return r+2};k.prototype.writeInt16BE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,2,32767,-32768);if(k.TYPED_ARRAY_SUPPORT){this[r]=i>>>8;this[r+1]=i&255}else{it(this,i,r,false)}return r+2};k.prototype.writeInt32LE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,4,2147483647,-2147483648);if(k.TYPED_ARRAY_SUPPORT){this[r]=i&255;this[r+1]=i>>>8;this[r+2]=i>>>16;this[r+3]=i>>>24}else{rt(this,i,r,true)}return r+4};k.prototype.writeInt32BE=function t(i,r,e){i=+i;r=r|0;if(!e)tt(this,i,r,4,2147483647,-2147483648);if(i<0)i=4294967295+i+1;if(k.TYPED_ARRAY_SUPPORT){this[r]=i>>>24;this[r+1]=i>>>16;this[r+2]=i>>>8;this[r+3]=i&255}else{rt(this,i,r,false)}return r+4};function et(t,i,r,e,n,f){if(r+e>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function nt(t,i,r,e,n){if(!n){et(t,i,r,4)}y(t,i,r,e,23,4);return r+4}k.prototype.writeFloatLE=function t(i,r,e){return nt(this,i,r,true,e)};k.prototype.writeFloatBE=function t(i,r,e){return nt(this,i,r,false,e)};function ft(t,i,r,e,n){if(!n){et(t,i,r,8)}y(t,i,r,e,52,8);return r+8}k.prototype.writeDoubleLE=function t(i,r,e){return ft(this,i,r,true,e)};k.prototype.writeDoubleBE=function t(i,r,e){return ft(this,i,r,false,e)};k.prototype.copy=function t(i,r,e,n){if(!e)e=0;if(!n&&n!==0)n=this.length;if(r>=i.length)r=i.length;if(!r)r=0;if(n>0&&n<e)n=e;if(n===e)return 0;if(i.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(i.length-r<n-e){n=i.length-r+e}var f=n-e;var s;if(this===i&&e<r&&r<n){for(s=f-1;s>=0;--s){i[s+r]=this[s+e]}}else if(f<1e3||!k.TYPED_ARRAY_SUPPORT){for(s=0;s<f;++s){i[s+r]=this[s+e]}}else{Uint8Array.prototype.set.call(i,this.subarray(e,e+f),r)}return f};k.prototype.fill=function t(i,r,e,n){if(typeof i==="string"){if(typeof r==="string"){n=r;r=0;e=this.length}else if(typeof e==="string"){n=e;e=this.length}if(i.length===1){var f=i.charCodeAt(0);if(f<256){i=f}}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!k.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}}else if(typeof i==="number"){i=i&255}if(r<0||this.length<r||this.length<e){throw new RangeError("Out of range index")}if(e<=r){return this}r=r>>>0;e=e===undefined?this.length:e>>>0;if(!i)i=0;var s;if(typeof i==="number"){for(s=r;s<e;++s){this[s]=i}}else{var u=I(i)?i:ht(new k(i,n).toString());var o=u.length;for(s=0;s<e-r;++s){this[s+r]=u[s%o]}}return this};var st=/[^+\/0-9A-Za-z-_]/g;function ut(t){t=ot(t).replace(st,"");if(t.length<2)return"";while(t.length%4!==0){t=t+"="}return t}function ot(t){if(t.trim)return t.trim();return t.replace(/^\s+|\s+$/g,"")}function at(t){if(t<16)return"0"+t.toString(16);return t.toString(16)}function ht(t,i){i=i||Infinity;var r;var e=t.length;var n=null;var f=[];for(var s=0;s<e;++s){r=t.charCodeAt(s);if(r>55295&&r<57344){if(!n){if(r>56319){if((i-=3)>-1)f.push(239,191,189);continue}else if(s+1===e){if((i-=3)>-1)f.push(239,191,189);continue}n=r;continue}if(r<56320){if((i-=3)>-1)f.push(239,191,189);n=r;continue}r=(n-55296<<10|r-56320)+65536}else if(n){if((i-=3)>-1)f.push(239,191,189)}n=null;if(r<128){if((i-=1)<0)break;f.push(r)}else if(r<2048){if((i-=2)<0)break;f.push(r>>6|192,r&63|128)}else if(r<65536){if((i-=3)<0)break;f.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((i-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return f}function ct(t){var i=[];for(var r=0;r<t.length;++r){i.push(t.charCodeAt(r)&255)}return i}function vt(t,i){var r,e,n;var f=[];for(var s=0;s<t.length;++s){if((i-=2)<0)break;r=t.charCodeAt(s);e=r>>8;n=r%256;f.push(n);f.push(e)}return f}function lt(t){return v(ut(t))}function dt(t,i,r,e){for(var n=0;n<e;++n){if(n+r>=i.length||n>=t.length)break;i[n+r]=t[n]}return n}function bt(t){return t!==t}function wt(t){return t!=null&&(!!t._isBuffer||yt(t)||gt(t))}function yt(t){return!!t.constructor&&typeof t.constructor.isBuffer==="function"&&t.constructor.isBuffer(t)}function gt(t){return typeof t.readFloatLE==="function"&&typeof t.slice==="function"&&yt(t.slice(0,0))}var pt=function(){function t(t,i){this.code="";this.scopes=[["vars"]];this.bitFields=[];this.tmpVariableCount=0;this.references=new Map;this.imports=[];this.reverseImports=new Map;this.useContextVariables=false;this.importPath=t;this.useContextVariables=i}t.prototype.generateVariable=function(t){var i=__spreadArray([],this.scopes[this.scopes.length-1],true);if(t){i.push(t)}return i.join(".")};t.prototype.generateOption=function(t){switch(typeof t){case"number":return t.toString();case"string":return this.generateVariable(t);case"function":return"".concat(this.addImport(t),".call(").concat(this.generateVariable(),", vars)")}};t.prototype.generateError=function(t){this.pushCode("throw new Error(".concat(t,");"))};t.prototype.generateTmpVariable=function(){return"$tmp"+this.tmpVariableCount++};t.prototype.pushCode=function(t){this.code+=t+"\n"};t.prototype.pushPath=function(t){if(t){this.scopes[this.scopes.length-1].push(t)}};t.prototype.popPath=function(t){if(t){this.scopes[this.scopes.length-1].pop()}};t.prototype.pushScope=function(t){this.scopes.push([t])};t.prototype.popScope=function(){this.scopes.pop()};t.prototype.addImport=function(t){if(!this.importPath)return"(".concat(t,")");var i=this.reverseImports.get(t);if(!i){i=this.imports.push(t)-1;this.reverseImports.set(t,i)}return"".concat(this.importPath,"[").concat(i,"]")};t.prototype.addReference=function(t){if(!this.references.has(t)){this.references.set(t,{resolved:false,requested:false})}};t.prototype.markResolved=function(t){var i=this.references.get(t);if(i){i.resolved=true}};t.prototype.markRequested=function(t){var i=this;t.forEach((function(t){var r=i.references.get(t);if(r){r.requested=true}}))};t.prototype.getUnresolvedReferences=function(){return Array.from(this.references).filter((function(t){var i=t[0],r=t[1];return!r.resolved&&!r.requested})).map((function(t){var i=t[0],r=t[1];return i}))};return t}();var mt=new Map;var _t="___parser_";var Et={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8};var kt={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"};var At={uint8:false,uint16le:true,uint16be:false,uint32le:true,uint32be:false,int8:false,int16le:true,int16be:false,int32le:true,int32be:false,int64be:false,int64le:true,uint64be:false,uint64le:true,floatle:true,floatbe:false,doublele:true,doublebe:false};var $t=function(){function t(){this.varName="";this.type="";this.options={};this.endian="be";this.useContextVariables=false}t.start=function(){return new t};t.prototype.primitiveGenerateN=function(t,i){var r=kt[t];var e=At[t];i.pushCode("".concat(i.generateVariable(this.varName)," = dataView.get").concat(r,"(offset, ").concat(e,");"));i.pushCode("offset += ".concat(Et[t],";"))};t.prototype.primitiveN=function(t,i,r){return this.setNextParser(t,i,r)};t.prototype.useThisEndian=function(t){return t+this.endian.toLowerCase()};t.prototype.uint8=function(t,i){if(i===void 0){i={}}return this.primitiveN("uint8",t,i)};t.prototype.uint16=function(t,i){if(i===void 0){i={}}return this.primitiveN(this.useThisEndian("uint16"),t,i)};t.prototype.uint16le=function(t,i){if(i===void 0){i={}}return this.primitiveN("uint16le",t,i)};t.prototype.uint16be=function(t,i){if(i===void 0){i={}}return this.primitiveN("uint16be",t,i)};t.prototype.uint32=function(t,i){if(i===void 0){i={}}return this.primitiveN(this.useThisEndian("uint32"),t,i)};t.prototype.uint32le=function(t,i){if(i===void 0){i={}}return this.primitiveN("uint32le",t,i)};t.prototype.uint32be=function(t,i){if(i===void 0){i={}}return this.primitiveN("uint32be",t,i)};t.prototype.int8=function(t,i){if(i===void 0){i={}}return this.primitiveN("int8",t,i)};t.prototype.int16=function(t,i){if(i===void 0){i={}}return this.primitiveN(this.useThisEndian("int16"),t,i)};t.prototype.int16le=function(t,i){if(i===void 0){i={}}return this.primitiveN("int16le",t,i)};t.prototype.int16be=function(t,i){if(i===void 0){i={}}return this.primitiveN("int16be",t,i)};t.prototype.int32=function(t,i){if(i===void 0){i={}}return this.primitiveN(this.useThisEndian("int32"),t,i)};t.prototype.int32le=function(t,i){if(i===void 0){i={}}return this.primitiveN("int32le",t,i)};t.prototype.int32be=function(t,i){if(i===void 0){i={}}return this.primitiveN("int32be",t,i)};t.prototype.bigIntVersionCheck=function(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")};t.prototype.int64=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("int64"),t,i)};t.prototype.int64be=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN("int64be",t,i)};t.prototype.int64le=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN("int64le",t,i)};t.prototype.uint64=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("uint64"),t,i)};t.prototype.uint64be=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN("uint64be",t,i)};t.prototype.uint64le=function(t,i){if(i===void 0){i={}}this.bigIntVersionCheck();return this.primitiveN("uint64le",t,i)};t.prototype.floatle=function(t,i){if(i===void 0){i={}}return this.primitiveN("floatle",t,i)};t.prototype.floatbe=function(t,i){if(i===void 0){i={}}return this.primitiveN("floatbe",t,i)};t.prototype.doublele=function(t,i){if(i===void 0){i={}}return this.primitiveN("doublele",t,i)};t.prototype.doublebe=function(t,i){if(i===void 0){i={}}return this.primitiveN("doublebe",t,i)};t.prototype.bitN=function(t,i,r){r.length=t;return this.setNextParser("bit",i,r)};t.prototype.bit1=function(t,i){if(i===void 0){i={}}return this.bitN(1,t,i)};t.prototype.bit2=function(t,i){if(i===void 0){i={}}return this.bitN(2,t,i)};t.prototype.bit3=function(t,i){if(i===void 0){i={}}return this.bitN(3,t,i)};t.prototype.bit4=function(t,i){if(i===void 0){i={}}return this.bitN(4,t,i)};t.prototype.bit5=function(t,i){if(i===void 0){i={}}return this.bitN(5,t,i)};t.prototype.bit6=function(t,i){if(i===void 0){i={}}return this.bitN(6,t,i)};t.prototype.bit7=function(t,i){if(i===void 0){i={}}return this.bitN(7,t,i)};t.prototype.bit8=function(t,i){if(i===void 0){i={}}return this.bitN(8,t,i)};t.prototype.bit9=function(t,i){if(i===void 0){i={}}return this.bitN(9,t,i)};t.prototype.bit10=function(t,i){if(i===void 0){i={}}return this.bitN(10,t,i)};t.prototype.bit11=function(t,i){if(i===void 0){i={}}return this.bitN(11,t,i)};t.prototype.bit12=function(t,i){if(i===void 0){i={}}return this.bitN(12,t,i)};t.prototype.bit13=function(t,i){if(i===void 0){i={}}return this.bitN(13,t,i)};t.prototype.bit14=function(t,i){if(i===void 0){i={}}return this.bitN(14,t,i)};t.prototype.bit15=function(t,i){if(i===void 0){i={}}return this.bitN(15,t,i)};t.prototype.bit16=function(t,i){if(i===void 0){i={}}return this.bitN(16,t,i)};t.prototype.bit17=function(t,i){if(i===void 0){i={}}return this.bitN(17,t,i)};t.prototype.bit18=function(t,i){if(i===void 0){i={}}return this.bitN(18,t,i)};t.prototype.bit19=function(t,i){if(i===void 0){i={}}return this.bitN(19,t,i)};t.prototype.bit20=function(t,i){if(i===void 0){i={}}return this.bitN(20,t,i)};t.prototype.bit21=function(t,i){if(i===void 0){i={}}return this.bitN(21,t,i)};t.prototype.bit22=function(t,i){if(i===void 0){i={}}return this.bitN(22,t,i)};t.prototype.bit23=function(t,i){if(i===void 0){i={}}return this.bitN(23,t,i)};t.prototype.bit24=function(t,i){if(i===void 0){i={}}return this.bitN(24,t,i)};t.prototype.bit25=function(t,i){if(i===void 0){i={}}return this.bitN(25,t,i)};t.prototype.bit26=function(t,i){if(i===void 0){i={}}return this.bitN(26,t,i)};t.prototype.bit27=function(t,i){if(i===void 0){i={}}return this.bitN(27,t,i)};t.prototype.bit28=function(t,i){if(i===void 0){i={}}return this.bitN(28,t,i)};t.prototype.bit29=function(t,i){if(i===void 0){i={}}return this.bitN(29,t,i)};t.prototype.bit30=function(t,i){if(i===void 0){i={}}return this.bitN(30,t,i)};t.prototype.bit31=function(t,i){if(i===void 0){i={}}return this.bitN(31,t,i)};t.prototype.bit32=function(t,i){if(i===void 0){i={}}return this.bitN(32,t,i)};t.prototype.namely=function(t){mt.set(t,this);this.alias=t;return this};t.prototype.skip=function(t,i){if(i===void 0){i={}}return this.seek(t,i)};t.prototype.seek=function(t,i){if(i===void 0){i={}}if(i.assert){throw new Error("assert option on seek is not allowed.")}return this.setNextParser("seek","",{length:t})};t.prototype.string=function(t,i){if(!i.zeroTerminated&&!i.length&&!i.greedy){throw new Error("One of length, zeroTerminated, or greedy must be defined for string.")}if((i.zeroTerminated||i.length)&&i.greedy){throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.")}if(i.stripNull&&!(i.length||i.greedy)){throw new Error("length or greedy must be defined if stripNull is enabled.")}i.encoding=i.encoding||"utf8";return this.setNextParser("string",t,i)};t.prototype.buffer=function(t,i){if(!i.length&&!i.readUntil){throw new Error("length or readUntil must be defined for buffer.")}return this.setNextParser("buffer",t,i)};t.prototype.wrapped=function(t,i){if(typeof i!=="object"&&typeof t==="object"){i=t;t=""}if(!i||!i.wrapper||!i.type){throw new Error("Both wrapper and type must be defined for wrapped.")}if(!i.length&&!i.readUntil){throw new Error("length or readUntil must be defined for wrapped.")}return this.setNextParser("wrapper",t,i)};t.prototype.array=function(t,i){if(!i.readUntil&&!i.length&&!i.lengthInBytes){throw new Error("One of readUntil, length and lengthInBytes must be defined for array.")}if(!i.type){throw new Error("type is required for array.")}if(typeof i.type==="string"&&!mt.has(i.type)&&!(i.type in Et)){throw new Error('Array element type "'.concat(i.type,'" is unkown.'))}return this.setNextParser("array",t,i)};t.prototype.choice=function(t,i){if(typeof i!=="object"&&typeof t==="object"){i=t;t=""}if(!i){throw new Error("tag and choices are are required for choice.")}if(!i.tag){throw new Error("tag is requird for choice.")}if(!i.choices){throw new Error("choices is required for choice.")}for(var r in i.choices){var e=parseInt(r,10);var n=i.choices[e];if(isNaN(e)){throw new Error('Choice key "'.concat(r,'" is not a number.'))}if(typeof n==="string"&&!mt.has(n)&&!(n in Et)){throw new Error('Choice type "'.concat(n,'" is unkown.'))}}return this.setNextParser("choice",t,i)};t.prototype.nest=function(i,r){if(typeof r!=="object"&&typeof i==="object"){r=i;i=""}if(!r||!r.type){throw new Error("type is required for nest.")}if(!(r.type instanceof t)&&!mt.has(r.type)){throw new Error("type must be a known parser name or a Parser object.")}if(!(r.type instanceof t)&&!i){throw new Error("type must be a Parser object if the variable name is omitted.")}return this.setNextParser("nest",i,r)};t.prototype.pointer=function(t,i){if(!i.offset){throw new Error("offset is required for pointer.")}if(!i.type){throw new Error("type is required for pointer.")}if(typeof i.type==="string"&&!(i.type in Et)&&!mt.has(i.type)){throw new Error('Pointer type "'.concat(i.type,'" is unkown.'))}return this.setNextParser("pointer",t,i)};t.prototype.saveOffset=function(t,i){if(i===void 0){i={}}return this.setNextParser("saveOffset",t,i)};t.prototype.endianness=function(t){switch(t.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this};t.prototype.endianess=function(t){return this.endianness(t)};t.prototype.useContextVars=function(t){if(t===void 0){t=true}this.useContextVariables=t;return this};t.prototype.create=function(t){if(!(t instanceof Function)){throw new Error("Constructor must be a Function object.")}this.constructorFn=t;return this};t.prototype.getContext=function(t){var i=new pt(t,this.useContextVariables);i.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);");if(!this.alias){this.addRawCode(i)}else{this.addAliasedCode(i);i.pushCode("return ".concat(_t+this.alias,"(0).result;"))}return i};t.prototype.getCode=function(){var t="imports";return this.getContext(t).code};t.prototype.addRawCode=function(t){t.pushCode("var offset = 0;");t.pushCode("var vars = ".concat(this.constructorFn?"new constructorFn()":"{}",";"));t.pushCode("vars.$parent = null;");t.pushCode("vars.$root = vars;");this.generate(t);this.resolveReferences(t);t.pushCode("delete vars.$parent;");t.pushCode("delete vars.$root;");t.pushCode("return vars;")};t.prototype.addAliasedCode=function(t){t.pushCode("function ".concat(_t+this.alias,"(offset, context) {"));t.pushCode("var vars = ".concat(this.constructorFn?"new constructorFn()":"{}",";"));t.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});");t.pushCode("vars = Object.assign(vars, ctx);");this.generate(t);t.markResolved(this.alias);this.resolveReferences(t);t.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });");t.pushCode("return { offset: offset, result: vars };");t.pushCode("}");return t};t.prototype.resolveReferences=function(t){var i=t.getUnresolvedReferences();t.markRequested(i);i.forEach((function(i){var r;(r=mt.get(i))===null||r===void 0?void 0:r.addAliasedCode(t)}))};t.prototype.compile=function(){var t="imports";var i=this.getContext(t);this.compiled=new Function(t,"TextDecoder","return function (buffer, constructorFn) { ".concat(i.code," };"))(i.imports,TextDecoder)};t.prototype.sizeOf=function(){var i=NaN;if(Object.keys(Et).indexOf(this.type)>=0){i=Et[this.type]}else if(this.type==="string"&&typeof this.options.length==="number"){i=this.options.length}else if(this.type==="buffer"&&typeof this.options.length==="number"){i=this.options.length}else if(this.type==="array"&&typeof this.options.length==="number"){var r=NaN;if(typeof this.options.type==="string"){r=Et[this.options.type]}else if(this.options.type instanceof t){r=this.options.type.sizeOf()}i=this.options.length*r}else if(this.type==="seek"){i=this.options.length}else if(this.type==="nest"){i=this.options.type.sizeOf()}else if(!this.type){i=0}if(this.next){i+=this.next.sizeOf()}return i};t.prototype.parse=function(t){if(!this.compiled){this.compile()}return this.compiled(t,this.constructorFn)};t.prototype.setNextParser=function(i,r,e){var n=new t;n.type=i;n.varName=r;n.options=e;n.endian=this.endian;if(this.head){this.head.next=n}else{this.next=n}this.head=n;return this};t.prototype.generate=function(t){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,t);break;case"bit":this.generateBit(t);break;case"string":this.generateString(t);break;case"buffer":this.generateBuffer(t);break;case"seek":this.generateSeek(t);break;case"nest":this.generateNest(t);break;case"array":this.generateArray(t);break;case"choice":this.generateChoice(t);break;case"pointer":this.generatePointer(t);break;case"saveOffset":this.generateSaveOffset(t);break;case"wrapper":this.generateWrapper(t);break}if(this.type!=="bit")this.generateAssert(t)}var i=t.generateVariable(this.varName);if(this.options.formatter&&this.type!=="bit"){this.generateFormatter(t,i,this.options.formatter)}return this.generateNext(t)};t.prototype.generateAssert=function(t){if(!this.options.assert){return}var i=t.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{var r=t.addImport(this.options.assert);t.pushCode("if (!".concat(r,".call(vars, ").concat(i,")) {"))}break;case"number":t.pushCode("if (".concat(this.options.assert," !== ").concat(i,") {"));break;case"string":t.pushCode("if (".concat(JSON.stringify(this.options.assert)," !== ").concat(i,") {"));break;default:throw new Error("assert option must be a string, number or a function.")}t.generateError('"Assertion error: '.concat(i,' is " + ').concat(JSON.stringify(this.options.assert.toString())));t.pushCode("}")};t.prototype.generateNext=function(t){if(this.next){t=this.next.generate(t)}return t};t.prototype.generateBit=function(t){var i=JSON.parse(JSON.stringify(this));i.options=this.options;i.generateAssert=this.generateAssert.bind(this);i.generateFormatter=this.generateFormatter.bind(this);i.varName=t.generateVariable(i.varName);t.bitFields.push(i);if(!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){var r=t.generateTmpVariable();t.pushCode("var ".concat(r," = 0;"));var e=function(i){if(i===void 0){i=0}var r=0;for(var e=i;e<t.bitFields.length;e++){var n=t.bitFields[e].options.length;if(r+n>32)break;r+=n}return r};var n=function(i){if(i<=8){t.pushCode("".concat(r," = dataView.getUint8(offset);"));i=8}else if(i<=16){t.pushCode("".concat(r," = dataView.getUint16(offset);"));i=16}else if(i<=24){t.pushCode("".concat(r," = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);"));i=24}else{t.pushCode("".concat(r," = dataView.getUint32(offset);"));i=32}t.pushCode("offset += ".concat(i/8,";"));return i};var f=0;var s=this.endian==="be";var u=0;var o=0;t.bitFields.forEach((function(i,a){var h=i.options.length;if(h>o){if(o){var c=-1>>>32-o;t.pushCode("".concat(i.varName," = (").concat(r," & 0x").concat(c.toString(16),") << ").concat(h-o,";"));h-=o}f=0;o=u=n(e(a)-o)}var v=s?u-f-h:f;var l=-1>>>32-h;t.pushCode("".concat(i.varName," ").concat(h<i.options.length?"|=":"="," ").concat(r," >> ").concat(v," & 0x").concat(l.toString(16),";"));if(i.options.length===32){t.pushCode("".concat(i.varName," >>>= 0"))}if(i.options.assert){i.generateAssert(t)}if(i.options.formatter){i.generateFormatter(t,i.varName,i.options.formatter)}f+=h;o-=h}));t.bitFields=[]}};t.prototype.generateSeek=function(t){var i=t.generateOption(this.options.length);t.pushCode("offset += ".concat(i,";"))};t.prototype.generateString=function(t){var i=t.generateVariable(this.varName);var r=t.generateTmpVariable();var e=this.options.encoding;var n=e.toLowerCase()==="hex";var f='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){var s=this.options.length;t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(dataView.getUint8(offset++) !== 0 && offset - ".concat(r," < ").concat(s,");"));var u="offset - ".concat(r," < ").concat(s," ? offset - 1 : offset");t.pushCode(n?"".concat(i," = Array.from(buffer.subarray(").concat(r,", ").concat(u,"), ").concat(f,").join('');"):"".concat(i," = new TextDecoder('").concat(e,"').decode(buffer.subarray(").concat(r,", ").concat(u,"));"))}else if(this.options.length){var s=t.generateOption(this.options.length);t.pushCode(n?"".concat(i," = Array.from(buffer.subarray(offset, offset + ").concat(s,"), ").concat(f,").join('');"):"".concat(i," = new TextDecoder('").concat(e,"').decode(buffer.subarray(offset, offset + ").concat(s,"));"));t.pushCode("offset += ".concat(s,";"))}else if(this.options.zeroTerminated){t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(dataView.getUint8(offset++) !== 0);");t.pushCode(n?"".concat(i," = Array.from(buffer.subarray(").concat(r,", offset - 1), ").concat(f,").join('');"):"".concat(i," = new TextDecoder('").concat(e,"').decode(buffer.subarray(").concat(r,", offset - 1));"))}else if(this.options.greedy){t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(buffer.length > offset++);");t.pushCode(n?"".concat(i," = Array.from(buffer.subarray(").concat(r,", offset), ").concat(f,").join('');"):"".concat(i," = new TextDecoder('").concat(e,"').decode(buffer.subarray(").concat(r,", offset));"))}if(this.options.stripNull){t.pushCode("".concat(i," = ").concat(i,".replace(/\\x00+$/g, '')"))}};t.prototype.generateBuffer=function(t){var i=t.generateVariable(this.varName);if(typeof this.options.readUntil==="function"){var r=this.options.readUntil;var e=t.generateTmpVariable();var n=t.generateTmpVariable();t.pushCode("var ".concat(e," = offset;"));t.pushCode("var ".concat(n," = 0;"));t.pushCode("while (offset < buffer.length) {");t.pushCode("".concat(n," = dataView.getUint8(offset);"));var f=t.addImport(r);t.pushCode("if (".concat(f,".call(").concat(t.generateVariable(),", ").concat(n,", buffer.subarray(offset))) break;"));t.pushCode("offset += 1;");t.pushCode("}");t.pushCode("".concat(i," = buffer.subarray(").concat(e,", offset);"))}else if(this.options.readUntil==="eof"){t.pushCode("".concat(i," = buffer.subarray(offset);"))}else{var s=t.generateOption(this.options.length);t.pushCode("".concat(i," = buffer.subarray(offset, offset + ").concat(s,");"));t.pushCode("offset += ".concat(s,";"))}if(this.options.clone){t.pushCode("".concat(i," = buffer.constructor.from(").concat(i,");"))}};t.prototype.generateArray=function(i){var r=i.generateOption(this.options.length);var e=i.generateOption(this.options.lengthInBytes);var n=this.options.type;var f=i.generateTmpVariable();var s=i.generateVariable(this.varName);var u=i.generateTmpVariable();var o=this.options.key;var a=typeof o==="string";if(a){i.pushCode("".concat(s," = {};"))}else{i.pushCode("".concat(s," = [];"))}if(typeof this.options.readUntil==="function"){i.pushCode("do {")}else if(this.options.readUntil==="eof"){i.pushCode("for (var ".concat(f," = 0; offset < buffer.length; ").concat(f,"++) {"))}else if(e!==undefined){i.pushCode("for (var ".concat(f," = offset + ").concat(e,"; offset < ").concat(f,"; ) {"))}else{i.pushCode("for (var ".concat(f," = ").concat(r,"; ").concat(f," > 0; ").concat(f,"--) {"))}if(typeof n==="string"){if(!mt.get(n)){var h=kt[n];var c=At[n];i.pushCode("var ".concat(u," = dataView.get").concat(h,"(offset, ").concat(c,");"));i.pushCode("offset += ".concat(Et[n],";"))}else{var v=i.generateTmpVariable();i.pushCode("var ".concat(v," = ").concat(_t+n,"(offset, {"));if(i.useContextVariables){var l=i.generateVariable();i.pushCode("$parent: ".concat(l,","));i.pushCode("$root: ".concat(l,".$root,"));if(!this.options.readUntil&&e===undefined){i.pushCode("$index: ".concat(r," - ").concat(f,","))}}i.pushCode("});");i.pushCode("var ".concat(u," = ").concat(v,".result; offset = ").concat(v,".offset;"));if(n!==this.alias)i.addReference(n)}}else if(n instanceof t){i.pushCode("var ".concat(u," = {};"));var l=i.generateVariable();i.pushScope(u);if(i.useContextVariables){i.pushCode("".concat(u,".$parent = ").concat(l,";"));i.pushCode("".concat(u,".$root = ").concat(l,".$root;"));if(!this.options.readUntil&&e===undefined){i.pushCode("".concat(u,".$index = ").concat(r," - ").concat(f,";"))}}n.generate(i);if(i.useContextVariables){i.pushCode("delete ".concat(u,".$parent;"));i.pushCode("delete ".concat(u,".$root;"));i.pushCode("delete ".concat(u,".$index;"))}i.popScope()}if(a){i.pushCode("".concat(s,"[").concat(u,".").concat(o,"] = ").concat(u,";"))}else{i.pushCode("".concat(s,".push(").concat(u,");"))}i.pushCode("}");if(typeof this.options.readUntil==="function"){var d=this.options.readUntil;var b=i.addImport(d);i.pushCode("while (!".concat(b,".call(").concat(i.generateVariable(),", ").concat(u,", buffer.subarray(offset)));"))}};t.prototype.generateChoiceCase=function(i,r,e){if(typeof e==="string"){var n=i.generateVariable(this.varName);if(!mt.has(e)){var f=kt[e];var s=At[e];i.pushCode("".concat(n," = dataView.get").concat(f,"(offset, ").concat(s,");"));i.pushCode("offset += ".concat(Et[e]))}else{var u=i.generateTmpVariable();i.pushCode("var ".concat(u," = ").concat(_t+e,"(offset, {"));if(i.useContextVariables){i.pushCode("$parent: ".concat(n,".$parent,"));i.pushCode("$root: ".concat(n,".$root,"))}i.pushCode("});");i.pushCode("".concat(n," = ").concat(u,".result; offset = ").concat(u,".offset;"));if(e!==this.alias)i.addReference(e)}}else if(e instanceof t){i.pushPath(r);e.generate(i);i.popPath(r)}};t.prototype.generateChoice=function(t){var i=t.generateOption(this.options.tag);var r=t.generateVariable(this.varName);if(this.varName){t.pushCode("".concat(r," = {};"));if(t.useContextVariables){var e=t.generateVariable();t.pushCode("".concat(r,".$parent = ").concat(e,";"));t.pushCode("".concat(r,".$root = ").concat(e,".$root;"))}}t.pushCode("switch(".concat(i,") {"));for(var n in this.options.choices){var f=parseInt(n,10);var s=this.options.choices[f];t.pushCode("case ".concat(f,":"));this.generateChoiceCase(t,this.varName,s);t.pushCode("break;")}t.pushCode("default:");if(this.options.defaultChoice){this.generateChoiceCase(t,this.varName,this.options.defaultChoice)}else{t.generateError('"Met undefined tag value " + '.concat(i,' + " at choice"'))}t.pushCode("}");if(this.varName&&t.useContextVariables){t.pushCode("delete ".concat(r,".$parent;"));t.pushCode("delete ".concat(r,".$root;"))}};t.prototype.generateNest=function(i){var r=i.generateVariable(this.varName);if(this.options.type instanceof t){if(this.varName){i.pushCode("".concat(r," = {};"));if(i.useContextVariables){var e=i.generateVariable();i.pushCode("".concat(r,".$parent = ").concat(e,";"));i.pushCode("".concat(r,".$root = ").concat(e,".$root;"))}}i.pushPath(this.varName);this.options.type.generate(i);i.popPath(this.varName);if(this.varName&&i.useContextVariables){if(i.useContextVariables){i.pushCode("delete ".concat(r,".$parent;"));i.pushCode("delete ".concat(r,".$root;"))}}}else if(mt.has(this.options.type)){var n=i.generateTmpVariable();i.pushCode("var ".concat(n," = ").concat(_t+this.options.type,"(offset, {"));if(i.useContextVariables){var e=i.generateVariable();i.pushCode("$parent: ".concat(e,","));i.pushCode("$root: ".concat(e,".$root,"))}i.pushCode("});");i.pushCode("".concat(r," = ").concat(n,".result; offset = ").concat(n,".offset;"));if(this.options.type!==this.alias){i.addReference(this.options.type)}}};t.prototype.generateWrapper=function(i){var r=i.generateVariable(this.varName);var e=i.generateTmpVariable();if(typeof this.options.readUntil==="function"){var n=this.options.readUntil;var f=i.generateTmpVariable();var s=i.generateTmpVariable();i.pushCode("var ".concat(f," = offset;"));i.pushCode("var ".concat(s," = 0;"));i.pushCode("while (offset < buffer.length) {");i.pushCode("".concat(s," = dataView.getUint8(offset);"));var u=i.addImport(n);i.pushCode("if (".concat(u,".call(").concat(i.generateVariable(),", ").concat(s,", buffer.subarray(offset))) break;"));i.pushCode("offset += 1;");i.pushCode("}");i.pushCode("".concat(e," = buffer.subarray(").concat(f,", offset);"))}else if(this.options.readUntil==="eof"){i.pushCode("".concat(e," = buffer.subarray(offset);"))}else{var o=i.generateOption(this.options.length);i.pushCode("".concat(e," = buffer.subarray(offset, offset + ").concat(o,");"));i.pushCode("offset += ".concat(o,";"))}if(this.options.clone){i.pushCode("".concat(e," = buffer.constructor.from(").concat(e,");"))}var a=i.generateTmpVariable();var h=i.generateTmpVariable();var c=i.generateTmpVariable();var v=i.addImport(this.options.wrapper);i.pushCode("".concat(e," = ").concat(v,".call(this, ").concat(e,").subarray(0);"));i.pushCode("var ".concat(a," = buffer;"));i.pushCode("var ".concat(h," = offset;"));i.pushCode("var ".concat(c," = dataView;"));i.pushCode("buffer = ".concat(e,";"));i.pushCode("offset = 0;");i.pushCode("dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);");if(this.options.type instanceof t){if(this.varName){i.pushCode("".concat(r," = {};"))}i.pushPath(this.varName);this.options.type.generate(i);i.popPath(this.varName)}else if(mt.has(this.options.type)){var l=i.generateTmpVariable();i.pushCode("var ".concat(l," = ").concat(_t+this.options.type,"(0);"));i.pushCode("".concat(r," = ").concat(l,".result;"));if(this.options.type!==this.alias){i.addReference(this.options.type)}}i.pushCode("buffer = ".concat(a,";"));i.pushCode("dataView = ".concat(c,";"));i.pushCode("offset = ".concat(h,";"))};t.prototype.generateFormatter=function(t,i,r){if(typeof r==="function"){var e=t.addImport(r);t.pushCode("".concat(i," = ").concat(e,".call(").concat(t.generateVariable(),", ").concat(i,");"))}};t.prototype.generatePointer=function(i){var r=this.options.type;var e=i.generateOption(this.options.offset);var n=i.generateTmpVariable();var f=i.generateVariable(this.varName);i.pushCode("var ".concat(n," = offset;"));i.pushCode("offset = ".concat(e,";"));if(this.options.type instanceof t){i.pushCode("".concat(f," = {};"));if(i.useContextVariables){var s=i.generateVariable();i.pushCode("".concat(f,".$parent = ").concat(s,";"));i.pushCode("".concat(f,".$root = ").concat(s,".$root;"))}i.pushPath(this.varName);this.options.type.generate(i);i.popPath(this.varName);if(i.useContextVariables){i.pushCode("delete ".concat(f,".$parent;"));i.pushCode("delete ".concat(f,".$root;"))}}else if(mt.has(this.options.type)){var u=i.generateTmpVariable();i.pushCode("var ".concat(u," = ").concat(_t+this.options.type,"(offset, {"));if(i.useContextVariables){var s=i.generateVariable();i.pushCode("$parent: ".concat(s,","));i.pushCode("$root: ".concat(s,".$root,"))}i.pushCode("});");i.pushCode("".concat(f," = ").concat(u,".result; offset = ").concat(u,".offset;"));if(this.options.type!==this.alias){i.addReference(this.options.type)}}else if(Object.keys(Et).indexOf(this.options.type)>=0){var o=kt[r];var a=At[r];i.pushCode("".concat(f," = dataView.get").concat(o,"(offset, ").concat(a,");"));i.pushCode("offset += ".concat(Et[r],";"))}i.pushCode("offset = ".concat(n,";"))};t.prototype.generateSaveOffset=function(t){var i=t.generateVariable(this.varName);t.pushCode("".concat(i," = offset"))};return t}();function xt(){return(new $t).endianess("little")}function Mt(){var t=xt().uint16("from").uint16("to");var i=xt().uint16("R").uint16("G").uint16("B");var r=xt().uint16("_chars").string("text",{length:"_chars"});return xt().uint16("_name").string("name",{length:"_name"}).uint16("_format").string("format",{length:"_format"}).uint16("_points").uint16("_limbs").uint16("_colors").array("points",{type:r,formatter:function(t){return t.map((function(t){return t.text}))},length:"_points"}).array("limbs",{type:t,length:"_limbs"}).array("colors",{type:i,length:"_colors"})}function Bt(){var t=Mt();return xt().floatle("version").uint16("width").uint16("height").uint16("depth").uint16("_components").array("components",{type:t,length:"_components"}).saveOffset("headerLength")}function Nt(t){var i=xt().int16("id");t.components.forEach((function(t){var r=xt();Array.from(t.format).forEach((function(t){r=r.floatle(t)}));i=i.array(t.name,{type:r,length:t._points})}));var r=xt().uint16("_people").array("people",{type:i,length:"_people"});return xt().seek(t.headerLength).uint16("fps").uint16("_frames").array("frames",{type:r,length:"_frames"})}function Ut(t,i){return Nt(t).parse(i)}function jt(t,i){var r=t.components.map((function(t){return t.points.length})).reduce((function(t,i){return t+i}),0);var e=Math.max.apply(Math,t.components.map((function(t){return t.format.length})))-1;var n=xt().seek(t.headerLength).uint16("fps").uint16("_frames").uint16("_people");var f=n.parse(i);var s=function(t,r){var e=new DataView(i.buffer,i.byteOffset,i.length);var n=r;var f={data:new Float32Array(t),offset:0};for(var s=0;s<f.data.length;s++){var u=e.getFloat32(n,true);n+=4;f.data[s]=u}f.offset=n;return f};var u=s(f._frames*f._people*r*e,t.headerLength+6);var o=s(f._frames*f._people*r,u.offset);function a(i){var n=new Array(f._people);var s=function(s){var a={};n[s]=a;var h=0;t.components.forEach((function(t){a[t.name]=[];var n=function(n){var c=i*(f._people*r)+s*r;var v=c+h+n;var l={C:o.data[v]};__spreadArray([],t.format,true).forEach((function(t,i){if(t!=="C"){l[t]=u.data[v*e+i]}}));a[t.name].push(l)};for(var c=0;c<t.points.length;c++){n(c)}h+=t.points.length}))};for(var a=0;a<f._people;a++){s(a)}return{people:n}}var h=new Proxy({},{get:function(t,i){if(i==="length"){return f._frames}return a(i)}});return Object.assign(Object.assign({},f),{frames:h})}var Tt=Bt();function It(t){var i=Tt.parse(t);var r;var e=Math.round(i.version*1e3)/1e3;switch(e){case 0:r=Ut(i,t);break;case.1:r=jt(i,t);break;default:throw new Error("Parsing this body version is not implemented - "+i.version)}return{header:i,body:r}}var Ot={};var Rt=Object.freeze({__proto__:null,default:Ot});var St=function(){function t(t,i){this.header=t;this.body=i}t.from=function(i){var r=It(i);return new t(r.header,r.body)};t.fromLocal=function(i){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(e){r=undefined(i);return[2,t.from(r)]}))}))};t.fromRemote=function(i,r){return __awaiter(this,void 0,void 0,(function(){var e,n,f,s,u,o,a,h,c;return __generator(this,(function(v){switch(v.label){case 0:n={};if(r){n.signal=r.signal}return[4,fetch(i,n)];case 1:f=v.sent();if(!!f.ok)return[3,6];s=(e=f.statusText)!==null&&e!==void 0?e:String(f.status);v.label=2;case 2:v.trys.push([2,4,,5]);return[4,f.json()];case 3:u=v.sent();s=u.message;return[3,5];case 4:o=v.sent();return[3,5];case 5:throw new Error(s);case 6:c=(h=k).from;return[4,f.arrayBuffer()];case 7:a=c.apply(h,[v.sent()]);return[2,t.from(a)]}}))}))};return t}();var Vt=function(){function t(t){this.viewer=t}t.prototype.x=function(t){var i=t*(this.viewer.elWidth-2*this.viewer.elPadding.width);return i/this.viewer.pose.header.width+this.viewer.elPadding.width};t.prototype.y=function(t){var i=t*(this.viewer.elHeight-2*this.viewer.elPadding.height);return i/this.viewer.pose.header.height+this.viewer.elPadding.height};t.prototype.isJointValid=function(t){return t.C>0};t.prototype.renderJoints=function(t,i){var r=this;return t.filter(this.isJointValid.bind(this)).map((function(t,e){return r.renderJoint(e,t,i[e%i.length])}))};t.prototype.renderLimbs=function(t,i,r){var e=this;return t.map((function(t){var n=t.from,f=t.to;var s=i[n];var u=i[f];if(!e.isJointValid(s)||!e.isJointValid(u)){return""}var o=r[n%r.length];var a=r[f%r.length];var h={R:(o.R+a.R)/2,G:(o.G+a.G)/2,B:(o.B+a.B)/2};return e.renderLimb(s,u,h)}))};t.prototype.renderFrame=function(t){var i=this;return t.people.map((function(t){return i.viewer.pose.header.components.map((function(r){var e=t[r.name];return[i.renderJoints(e,r.colors),i.renderLimbs(r.limbs,e,r.colors)]}))}))};return t}();var Ft=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.renderJoint=function(t,r,e){var n=e.R,f=e.G,s=e.B;return i("circle",{cx:r.X,cy:r.Y,r:4,class:"joint draggable",style:{fill:"rgb(".concat(n,", ").concat(f,", ").concat(s,")"),opacity:String(r.C)},"data-id":t})};r.prototype.renderLimb=function(t,r,e){var n=e.R,f=e.G,s=e.B;return i("line",{x1:t.X,y1:t.Y,x2:r.X,y2:r.Y,style:{stroke:"rgb(".concat(n,", ").concat(f,", ").concat(s,")"),opacity:String((t.C+r.C)/2)}})};r.prototype.render=function(t){var r="0 0 ".concat(this.viewer.pose.header.width," ").concat(this.viewer.pose.header.height);return i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:r,width:this.viewer.elWidth,height:this.viewer.elHeight},i("g",null,this.renderFrame(t)))};return r}(Vt);var Dt=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.renderJoint=function(t,i,r){var e=r.R,n=r.G,f=r.B;this.ctx.strokeStyle="rgba(0, 0, 0, 0)";this.ctx.fillStyle="rgba(".concat(e,", ").concat(n,", ").concat(f,", ").concat(i.C,")");var s=Math.round(this.thickness/3);this.ctx.beginPath();this.ctx.arc(this.x(i.X),this.y(i.Y),s,0,2*Math.PI);this.ctx.fill();this.ctx.stroke()};r.prototype.renderLimb=function(t,i,r){var e=r.R,n=r.G,f=r.B;this.ctx.lineWidth=this.thickness*5/4;this.ctx.strokeStyle="rgba(".concat(e,", ").concat(n,", ").concat(f,", ").concat((t.C+i.C)/2,")");this.ctx.beginPath();this.ctx.moveTo(this.x(t.X),this.y(t.Y));this.ctx.lineTo(this.x(i.X),this.y(i.Y));this.ctx.stroke()};r.prototype.render=function(t){var r=this;var e=function(){var i;var e=r.viewer.element.shadowRoot.querySelector("canvas");if(e){e.width=r.viewer.elWidth;e.height=r.viewer.elHeight;r.ctx=e.getContext("2d");if(r.viewer.background){r.ctx.fillStyle=r.viewer.background;r.ctx.fillRect(0,0,e.width,e.height)}else{r.ctx.clearRect(0,0,e.width,e.height)}var n=r.viewer.elWidth-2*r.viewer.elPadding.width;var f=r.viewer.elHeight-2*r.viewer.elPadding.height;r.thickness=(i=r.viewer.thickness)!==null&&i!==void 0?i:Math.round(Math.sqrt(n*f)/150);r.renderFrame(t)}else{throw new Error("Canvas isn't available before first render")}};try{e()}catch(t){requestAnimationFrame(e)}return i("canvas",{width:this.viewer.elWidth,height:this.viewer.elHeight})};return r}(Vt);var qt=":host{display:inline-block}svg,canvas{max-width:100%}svg circle{stroke:black;stroke-width:1px;opacity:0.8}svg line{stroke-width:8px;opacity:0.8;stroke:black}canvas{display:block}";var zt=t("pose_viewer",function(){function t(t){r(this,t);this.canplaythrough$=e(this,"canplaythrough$",7);this.ended$=e(this,"ended$",7);this.loadeddata$=e(this,"loadeddata$",7);this.loadedmetadata$=e(this,"loadedmetadata$",7);this.loadstart$=e(this,"loadstart$",7);this.pause$=e(this,"pause$",7);this.play$=e(this,"play$",7);this.firstRender$=e(this,"firstRender$",7);this.render$=e(this,"render$",7);this.hasRendered=false;this.src=undefined;this.svg=false;this.width=null;this.height=null;this.aspectRatio=null;this.padding=null;this.thickness=null;this.background=null;this.loop=false;this.autoplay=true;this.playbackRate=1;this.currentTime=NaN;this.duration=NaN;this.ended=false;this.paused=true;this.readyState=0;this.error=undefined}t.prototype.componentWillLoad=function(){this.renderer=this.svg?new Ft(this):new Dt(this);return this.srcChange()};t.prototype.componentDidLoad=function(){this.resizeObserver=new ResizeObserver(this.setDimensions.bind(this));this.resizeObserver.observe(this.element)};t.prototype.getRemotePose=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:if(this.fetchAbortController){this.fetchAbortController.abort()}this.fetchAbortController=new AbortController;t=this;return[4,St.fromRemote(this.src,this.fetchAbortController)];case 1:t.pose=i.sent();return[2]}}))}))};t.prototype.initPose=function(){this.setDimensions();this.loadedmetadata$.emit();this.loadeddata$.emit();this.canplaythrough$.emit();this.duration=(this.pose.body.frames.length-1)/this.pose.body.fps;this.currentTime=0;if(this.autoplay){this.play()}};t.prototype.srcChange=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:if(this.src===this.lastSrc){return[2]}this.lastSrc=this.src;this.clearInterval();this.setDimensions();delete this.pose;this.currentTime=NaN;this.duration=NaN;this.hasRendered=false;if(!this.src){return[2]}this.ended=false;this.loadstart$.emit();this.error=null;i.label=1;case 1:i.trys.push([1,3,,4]);return[4,this.getRemotePose()];case 2:i.sent();this.initPose();this.error=null;return[3,4];case 3:t=i.sent();console.error("PoseViewer error",t);this.error=t;return[3,4];case 4:return[2]}}))}))};t.prototype.setDimensions=function(){this.elPadding={width:0,height:0};if(!this.pose){this.elWidth=0;this.elHeight=0;return}if(!this.width&&!this.height){this.elWidth=this.pose.header.width;this.elHeight=this.pose.header.height;return}var t=this.element.getBoundingClientRect();var i=function(t,i){return t.endsWith("px")?Number(t.slice(0,-2)):t.endsWith("%")?i*t.slice(0,-1)/100:Number(t)};if(this.width&&this.height){this.elWidth=i(this.width,t.width);this.elHeight=i(this.height,t.height)}else if(this.width){this.elWidth=i(this.width,t.width);this.elHeight=this.aspectRatio?this.elWidth*this.aspectRatio:this.pose.header.height/this.pose.header.width*this.elWidth}else if(this.height){this.elHeight=i(this.height,t.height);this.elWidth=this.aspectRatio?this.elHeight/this.aspectRatio:this.pose.header.width/this.pose.header.height*this.elHeight}if(this.padding){this.elPadding.width+=i(this.padding,this.elWidth);this.elPadding.height+=i(this.padding,this.elHeight)}var r=this.elWidth-this.elPadding.width*2;var e=this.elHeight-this.elPadding.height*2;var n=r/e;var f=this.pose.header.width/this.pose.header.height;if(f>n){this.elPadding.height+=(f-n)*e/2}else{this.elPadding.width+=(1/f-1/n)*r/2}};t.prototype.syncMedia=function(t){return __awaiter(this,void 0,void 0,(function(){var i,r;var e=this;return __generator(this,(function(n){this.media=t;this.media.addEventListener("pause",this.pause.bind(this));this.media.addEventListener("play",this.play.bind(this));i=function(){return e.currentTime=e.frameTime(e.media.currentTime)};this.media.addEventListener("seek",i);this.media.addEventListener("timeupdate",i);r=function(){return e.playbackRate=e.media.playbackRate};this.media.addEventListener("ratechange",r);r();this.clearInterval();if(this.media.paused){this.pause()}else{this.play()}return[2]}))}))};t.prototype.getPose=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.pose]}))}))};t.prototype.nextFrame=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(i){t=this.currentTime+1/this.pose.body.fps;if(t>this.duration){if(this.loop){this.currentTime=t%this.duration}else{this.ended$.emit();this.ended=true}}else{this.currentTime=t}return[2]}))}))};t.prototype.frameTime=function(t){if(!this.pose){return 0}return Math.floor(t*this.pose.body.fps)/this.pose.body.fps};t.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){var t,i;var r=this;return __generator(this,(function(e){if(!this.paused){this.clearInterval()}this.paused=false;this.play$.emit();if(this.currentTime>this.duration){this.currentTime=0}t=1e3/(this.pose.body.fps*this.playbackRate);if(this.media){this.loopInterval=setInterval((function(){return r.currentTime=r.frameTime(r.media.currentTime)}),t)}else{i=Date.now()/1e3;this.loopInterval=setInterval((function(){var t=Date.now()/1e3;r.currentTime+=(t-i)*r.playbackRate;i=t;if(r.currentTime>r.duration){if(r.loop){r.currentTime=r.currentTime%r.duration}else{r.ended$.emit();r.ended=true;r.clearInterval()}}}),t)}return[2]}))}))};t.prototype.pause=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.paused=true;this.pause$.emit();this.clearInterval();return[2]}))}))};t.prototype.clearInterval=function(){if(this.loopInterval){clearInterval(this.loopInterval)}};t.prototype.disconnectedCallback=function(){this.clearInterval()};t.prototype.render=function(){var t=this;if(this.error){return this.error.name!=="AbortError"?this.error.message:""}if(!this.pose||isNaN(this.currentTime)||!this.renderer){return""}var r=this.currentTime>this.duration?this.duration:this.currentTime;var e=Math.floor(r*this.pose.body.fps);var n=this.pose.body.frames[e];var s=this.renderer.render(n);if(!this.hasRendered){requestAnimationFrame((function(){t.hasRendered=true;t.firstRender$.emit()}))}requestAnimationFrame((function(){return t.render$.emit()}));return i(f,null,s)};Object.defineProperty(t.prototype,"element",{get:function(){return n(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{src:["srcChange"]}},enumerable:false,configurable:true});return t}());zt.style=qt}}}));
//# sourceMappingURL=p-c133f3e4.system.entry.js.map