var __extends=this&&this.__extends||function(){var t=function(e,r){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]};return t(e,r)};return function(e,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function i(){this.constructor=e}e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var __awaiter=this&&this.__awaiter||function(t,e,r,i){function n(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,f){function s(t){try{o(i.next(t))}catch(t){f(t)}}function u(t){try{o(i["throw"](t))}catch(t){f(t)}}function o(t){t.done?r(t.value):n(t.value).then(s,u)}o((i=i.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},i,n,f,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(t){return function(e){return o([t,e])}}function o(u){if(i)throw new TypeError("Generator is already executing.");while(s&&(s=0,u[0]&&(r=0)),r)try{if(i=1,n&&(f=u[0]&2?n["return"]:u[0]?n["throw"]||((f=n["return"])&&f.call(n),0):n.next)&&!(f=f.call(n,u[1])).done)return f;if(n=0,f)u=[u[0]&2,f.value];switch(u[0]){case 0:case 1:f=u;break;case 4:r.label++;return{value:u[1],done:false};case 5:r.label++;n=u[1];u=[0];continue;case 7:u=r.ops.pop();r.trys.pop();continue;default:if(!(f=r.trys,f=f.length>0&&f[f.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!f||u[1]>f[0]&&u[1]<f[3])){r.label=u[1];break}if(u[0]===6&&r.label<f[1]){r.label=f[1];f=u;break}if(f&&r.label<f[2]){r.label=f[2];r.ops.push(u);break}if(f[2])r.ops.pop();r.trys.pop();continue}u=e.call(t,r)}catch(t){u=[6,t];n=0}finally{i=f=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,f;i<n;i++){if(f||!(i in e)){if(!f)f=Array.prototype.slice.call(e,0,i);f[i]=e[i]}}return t.concat(f||Array.prototype.slice.call(e))};import{h,r as registerInstance,c as createEvent,g as getElement,H as Host}from"./index-b27121e8.js";var global$1=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var inited=false;function init(){inited=true;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var e=0,r=t.length;e<r;++e){lookup[e]=t[e];revLookup[t.charCodeAt(e)]=e}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63}function toByteArray(t){if(!inited){init()}var e,r,i,n,f,s;var u=t.length;if(u%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}f=t[u-2]==="="?2:t[u-1]==="="?1:0;s=new Arr(u*3/4-f);i=f>0?u-4:u;var o=0;for(e=0,r=0;e<i;e+=4,r+=3){n=revLookup[t.charCodeAt(e)]<<18|revLookup[t.charCodeAt(e+1)]<<12|revLookup[t.charCodeAt(e+2)]<<6|revLookup[t.charCodeAt(e+3)];s[o++]=n>>16&255;s[o++]=n>>8&255;s[o++]=n&255}if(f===2){n=revLookup[t.charCodeAt(e)]<<2|revLookup[t.charCodeAt(e+1)]>>4;s[o++]=n&255}else if(f===1){n=revLookup[t.charCodeAt(e)]<<10|revLookup[t.charCodeAt(e+1)]<<4|revLookup[t.charCodeAt(e+2)]>>2;s[o++]=n>>8&255;s[o++]=n&255}return s}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[t&63]}function encodeChunk(t,e,r){var i;var n=[];for(var f=e;f<r;f+=3){i=(t[f]<<16)+(t[f+1]<<8)+t[f+2];n.push(tripletToBase64(i))}return n.join("")}function fromByteArray(t){if(!inited){init()}var e;var r=t.length;var i=r%3;var n="";var f=[];var s=16383;for(var u=0,o=r-i;u<o;u+=s){f.push(encodeChunk(t,u,u+s>o?o:u+s))}if(i===1){e=t[r-1];n+=lookup[e>>2];n+=lookup[e<<4&63];n+="=="}else if(i===2){e=(t[r-2]<<8)+t[r-1];n+=lookup[e>>10];n+=lookup[e>>4&63];n+=lookup[e<<2&63];n+="="}f.push(n);return f.join("")}function read(t,e,r,i,n){var f,s;var u=n*8-i-1;var o=(1<<u)-1;var a=o>>1;var h=-7;var c=r?n-1:0;var l=r?-1:1;var v=t[e+c];c+=l;f=v&(1<<-h)-1;v>>=-h;h+=u;for(;h>0;f=f*256+t[e+c],c+=l,h-=8){}s=f&(1<<-h)-1;f>>=-h;h+=i;for(;h>0;s=s*256+t[e+c],c+=l,h-=8){}if(f===0){f=1-a}else if(f===o){return s?NaN:(v?-1:1)*Infinity}else{s=s+Math.pow(2,i);f=f-a}return(v?-1:1)*s*Math.pow(2,f-i)}function write(t,e,r,i,n,f){var s,u,o;var a=f*8-n-1;var h=(1<<a)-1;var c=h>>1;var l=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var v=i?0:f-1;var d=i?1:-1;var b=e<0||e===0&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===Infinity){u=isNaN(e)?1:0;s=h}else{s=Math.floor(Math.log(e)/Math.LN2);if(e*(o=Math.pow(2,-s))<1){s--;o*=2}if(s+c>=1){e+=l/o}else{e+=l*Math.pow(2,1-c)}if(e*o>=2){s++;o/=2}if(s+c>=h){u=0;s=h}else if(s+c>=1){u=(e*o-1)*Math.pow(2,n);s=s+c}else{u=e*Math.pow(2,c-1)*Math.pow(2,n);s=0}}for(;n>=8;t[r+v]=u&255,v+=d,u/=256,n-=8){}s=s<<n|u;a+=n;for(;a>0;t[r+v]=s&255,v+=d,s/=256,a-=8){}t[r+v-d]|=b*128}var toString={}.toString;var isArray=Array.isArray||function(t){return toString.call(t)=="[object Array]"};
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT!==undefined?global$1.TYPED_ARRAY_SUPPORT:true;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){t=new Uint8Array(e);t.__proto__=Buffer.prototype}else{if(t===null){t=new Buffer(e)}t.length=e}return t}function Buffer(t,e,r){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(t,e,r)}if(typeof t==="number"){if(typeof e==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,t)}return from(this,t,e,r)}Buffer.poolSize=8192;Buffer._augment=function(t){t.__proto__=Buffer.prototype;return t};function from(t,e,r,i){if(typeof e==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer){return fromArrayBuffer(t,e,r,i)}if(typeof e==="string"){return fromString(t,e,r)}return fromObject(t,e)}Buffer.from=function(t,e,r){return from(null,t,e,r)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array}function assertSize(t){if(typeof t!=="number"){throw new TypeError('"size" argument must be a number')}else if(t<0){throw new RangeError('"size" argument must not be negative')}}function alloc(t,e,r,i){assertSize(e);if(e<=0){return createBuffer(t,e)}if(r!==undefined){return typeof i==="string"?createBuffer(t,e).fill(r,i):createBuffer(t,e).fill(r)}return createBuffer(t,e)}Buffer.alloc=function(t,e,r){return alloc(null,t,e,r)};function allocUnsafe(t,e){assertSize(e);t=createBuffer(t,e<0?0:checked(e)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var r=0;r<e;++r){t[r]=0}}return t}Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)};Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)};function fromString(t,e,r){if(typeof r!=="string"||r===""){r="utf8"}if(!Buffer.isEncoding(r)){throw new TypeError('"encoding" must be a valid string encoding')}var i=byteLength(e,r)|0;t=createBuffer(t,i);var n=t.write(e,r);if(n!==i){t=t.slice(0,n)}return t}function fromArrayLike(t,e){var r=e.length<0?0:checked(e.length)|0;t=createBuffer(t,r);for(var i=0;i<r;i+=1){t[i]=e[i]&255}return t}function fromArrayBuffer(t,e,r,i){if(r<0||e.byteLength<r){throw new RangeError("'offset' is out of bounds")}if(e.byteLength<r+(i||0)){throw new RangeError("'length' is out of bounds")}if(r===undefined&&i===undefined){e=new Uint8Array(e)}else if(i===undefined){e=new Uint8Array(e,r)}else{e=new Uint8Array(e,r,i)}if(Buffer.TYPED_ARRAY_SUPPORT){t=e;t.__proto__=Buffer.prototype}else{t=fromArrayLike(t,e)}return t}function fromObject(t,e){if(internalIsBuffer(e)){var r=checked(e.length)|0;t=createBuffer(t,r);if(t.length===0){return t}e.copy(t,0,0,r);return t}if(e){if(typeof ArrayBuffer!=="undefined"&&e.buffer instanceof ArrayBuffer||"length"in e){if(typeof e.length!=="number"||isnan(e.length)){return createBuffer(t,0)}return fromArrayLike(t,e)}if(e.type==="Buffer"&&isArray(e.data)){return fromArrayLike(t,e.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return t|0}Buffer.isBuffer=isBuffer;function internalIsBuffer(t){return!!(t!=null&&t._isBuffer)}Buffer.compare=function t(e,r){if(!internalIsBuffer(e)||!internalIsBuffer(r)){throw new TypeError("Arguments must be Buffers")}if(e===r)return 0;var i=e.length;var n=r.length;for(var f=0,s=Math.min(i,n);f<s;++f){if(e[f]!==r[f]){i=e[f];n=r[f];break}}if(i<n)return-1;if(n<i)return 1;return 0};Buffer.isEncoding=function t(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function t(e,r){if(!isArray(e)){throw new TypeError('"list" argument must be an Array of Buffers')}if(e.length===0){return Buffer.alloc(0)}var i;if(r===undefined){r=0;for(i=0;i<e.length;++i){r+=e[i].length}}var n=Buffer.allocUnsafe(r);var f=0;for(i=0;i<e.length;++i){var s=e[i];if(!internalIsBuffer(s)){throw new TypeError('"list" argument must be an Array of Buffers')}s.copy(n,f);f+=s.length}return n};function byteLength(t,e){if(internalIsBuffer(t)){return t.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)){return t.byteLength}if(typeof t!=="string"){t=""+t}var r=t.length;if(r===0)return 0;var i=false;for(;;){switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case undefined:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(i)return utf8ToBytes(t).length;e=(""+e).toLowerCase();i=true}}}Buffer.byteLength=byteLength;function slowToString(t,e,r){var i=false;if(e===undefined||e<0){e=0}if(e>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;e>>>=0;if(r<=e){return""}if(!t)t="utf8";while(true){switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"latin1":case"binary":return latin1Slice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase();i=true}}}Buffer.prototype._isBuffer=true;function swap(t,e,r){var i=t[e];t[e]=t[r];t[r]=i}Buffer.prototype.swap16=function t(){var e=this.length;if(e%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<e;r+=2){swap(this,r,r+1)}return this};Buffer.prototype.swap32=function t(){var e=this.length;if(e%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<e;r+=4){swap(this,r,r+3);swap(this,r+1,r+2)}return this};Buffer.prototype.swap64=function t(){var e=this.length;if(e%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<e;r+=8){swap(this,r,r+7);swap(this,r+1,r+6);swap(this,r+2,r+5);swap(this,r+3,r+4)}return this};Buffer.prototype.toString=function t(){var e=this.length|0;if(e===0)return"";if(arguments.length===0)return utf8Slice(this,0,e);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function t(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(this===e)return true;return Buffer.compare(this,e)===0};Buffer.prototype.inspect=function t(){var e="";var r=INSPECT_MAX_BYTES;if(this.length>0){e=this.toString("hex",0,r).match(/.{2}/g).join(" ");if(this.length>r)e+=" ... "}return"<Buffer "+e+">"};Buffer.prototype.compare=function t(e,r,i,n,f){if(!internalIsBuffer(e)){throw new TypeError("Argument must be a Buffer")}if(r===undefined){r=0}if(i===undefined){i=e?e.length:0}if(n===undefined){n=0}if(f===undefined){f=this.length}if(r<0||i>e.length||n<0||f>this.length){throw new RangeError("out of range index")}if(n>=f&&r>=i){return 0}if(n>=f){return-1}if(r>=i){return 1}r>>>=0;i>>>=0;n>>>=0;f>>>=0;if(this===e)return 0;var s=f-n;var u=i-r;var o=Math.min(s,u);var a=this.slice(n,f);var h=e.slice(r,i);for(var c=0;c<o;++c){if(a[c]!==h[c]){s=a[c];u=h[c];break}}if(s<u)return-1;if(u<s)return 1;return 0};function bidirectionalIndexOf(t,e,r,i,n){if(t.length===0)return-1;if(typeof r==="string"){i=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(isNaN(r)){r=n?0:t.length-1}if(r<0)r=t.length+r;if(r>=t.length){if(n)return-1;else r=t.length-1}else if(r<0){if(n)r=0;else return-1}if(typeof e==="string"){e=Buffer.from(e,i)}if(internalIsBuffer(e)){if(e.length===0){return-1}return arrayIndexOf(t,e,r,i,n)}else if(typeof e==="number"){e=e&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(t,e,r)}else{return Uint8Array.prototype.lastIndexOf.call(t,e,r)}}return arrayIndexOf(t,[e],r,i,n)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,r,i,n){var f=1;var s=t.length;var u=e.length;if(i!==undefined){i=String(i).toLowerCase();if(i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le"){if(t.length<2||e.length<2){return-1}f=2;s/=2;u/=2;r/=2}}function o(t,e){if(f===1){return t[e]}else{return t.readUInt16BE(e*f)}}var a;if(n){var h=-1;for(a=r;a<s;a++){if(o(t,a)===o(e,h===-1?0:a-h)){if(h===-1)h=a;if(a-h+1===u)return h*f}else{if(h!==-1)a-=a-h;h=-1}}}else{if(r+u>s)r=s-u;for(a=r;a>=0;a--){var c=true;for(var l=0;l<u;l++){if(o(t,a+l)!==o(e,l)){c=false;break}}if(c)return a}}return-1}Buffer.prototype.includes=function t(e,r,i){return this.indexOf(e,r,i)!==-1};Buffer.prototype.indexOf=function t(e,r,i){return bidirectionalIndexOf(this,e,r,i,true)};Buffer.prototype.lastIndexOf=function t(e,r,i){return bidirectionalIndexOf(this,e,r,i,false)};function hexWrite(t,e,r,i){r=Number(r)||0;var n=t.length-r;if(!i){i=n}else{i=Number(i);if(i>n){i=n}}var f=e.length;if(f%2!==0)throw new TypeError("Invalid hex string");if(i>f/2){i=f/2}for(var s=0;s<i;++s){var u=parseInt(e.substr(s*2,2),16);if(isNaN(u))return s;t[r+s]=u}return s}function utf8Write(t,e,r,i){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,i)}function asciiWrite(t,e,r,i){return blitBuffer(asciiToBytes(e),t,r,i)}function latin1Write(t,e,r,i){return asciiWrite(t,e,r,i)}function base64Write(t,e,r,i){return blitBuffer(base64ToBytes(e),t,r,i)}function ucs2Write(t,e,r,i){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,i)}Buffer.prototype.write=function t(e,r,i,n){if(r===undefined){n="utf8";i=this.length;r=0}else if(i===undefined&&typeof r==="string"){n=r;i=this.length;r=0}else if(isFinite(r)){r=r|0;if(isFinite(i)){i=i|0;if(n===undefined)n="utf8"}else{n=i;i=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var f=this.length-r;if(i===undefined||i>f)i=f;if(e.length>0&&(i<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var s=false;for(;;){switch(n){case"hex":return hexWrite(this,e,r,i);case"utf8":case"utf-8":return utf8Write(this,e,r,i);case"ascii":return asciiWrite(this,e,r,i);case"latin1":case"binary":return latin1Write(this,e,r,i);case"base64":return base64Write(this,e,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,r,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();s=true}}};Buffer.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(t,e,r){if(e===0&&r===t.length){return fromByteArray(t)}else{return fromByteArray(t.slice(e,r))}}function utf8Slice(t,e,r){r=Math.min(t.length,r);var i=[];var n=e;while(n<r){var f=t[n];var s=null;var u=f>239?4:f>223?3:f>191?2:1;if(n+u<=r){var o,a,h,c;switch(u){case 1:if(f<128){s=f}break;case 2:o=t[n+1];if((o&192)===128){c=(f&31)<<6|o&63;if(c>127){s=c}}break;case 3:o=t[n+1];a=t[n+2];if((o&192)===128&&(a&192)===128){c=(f&15)<<12|(o&63)<<6|a&63;if(c>2047&&(c<55296||c>57343)){s=c}}break;case 4:o=t[n+1];a=t[n+2];h=t[n+3];if((o&192)===128&&(a&192)===128&&(h&192)===128){c=(f&15)<<18|(o&63)<<12|(a&63)<<6|h&63;if(c>65535&&c<1114112){s=c}}}}if(s===null){s=65533;u=1}else if(s>65535){s-=65536;i.push(s>>>10&1023|55296);s=56320|s&1023}i.push(s);n+=u}return decodeCodePointsArray(i)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(t){var e=t.length;if(e<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,t)}var r="";var i=0;while(i<e){r+=String.fromCharCode.apply(String,t.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return r}function asciiSlice(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n){i+=String.fromCharCode(t[n]&127)}return i}function latin1Slice(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n){i+=String.fromCharCode(t[n])}return i}function hexSlice(t,e,r){var i=t.length;if(!e||e<0)e=0;if(!r||r<0||r>i)r=i;var n="";for(var f=e;f<r;++f){n+=toHex(t[f])}return n}function utf16leSlice(t,e,r){var i=t.slice(e,r);var n="";for(var f=0;f<i.length;f+=2){n+=String.fromCharCode(i[f]+i[f+1]*256)}return n}Buffer.prototype.slice=function t(e,r){var i=this.length;e=~~e;r=r===undefined?i:~~r;if(e<0){e+=i;if(e<0)e=0}else if(e>i){e=i}if(r<0){r+=i;if(r<0)r=0}else if(r>i){r=i}if(r<e)r=e;var n;if(Buffer.TYPED_ARRAY_SUPPORT){n=this.subarray(e,r);n.__proto__=Buffer.prototype}else{var f=r-e;n=new Buffer(f,undefined);for(var s=0;s<f;++s){n[s]=this[s+e]}}return n};function checkOffset(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function t(e,r,i){e=e|0;r=r|0;if(!i)checkOffset(e,r,this.length);var n=this[e];var f=1;var s=0;while(++s<r&&(f*=256)){n+=this[e+s]*f}return n};Buffer.prototype.readUIntBE=function t(e,r,i){e=e|0;r=r|0;if(!i){checkOffset(e,r,this.length)}var n=this[e+--r];var f=1;while(r>0&&(f*=256)){n+=this[e+--r]*f}return n};Buffer.prototype.readUInt8=function t(e,r){if(!r)checkOffset(e,1,this.length);return this[e]};Buffer.prototype.readUInt16LE=function t(e,r){if(!r)checkOffset(e,2,this.length);return this[e]|this[e+1]<<8};Buffer.prototype.readUInt16BE=function t(e,r){if(!r)checkOffset(e,2,this.length);return this[e]<<8|this[e+1]};Buffer.prototype.readUInt32LE=function t(e,r){if(!r)checkOffset(e,4,this.length);return(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};Buffer.prototype.readUInt32BE=function t(e,r){if(!r)checkOffset(e,4,this.length);return this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};Buffer.prototype.readIntLE=function t(e,r,i){e=e|0;r=r|0;if(!i)checkOffset(e,r,this.length);var n=this[e];var f=1;var s=0;while(++s<r&&(f*=256)){n+=this[e+s]*f}f*=128;if(n>=f)n-=Math.pow(2,8*r);return n};Buffer.prototype.readIntBE=function t(e,r,i){e=e|0;r=r|0;if(!i)checkOffset(e,r,this.length);var n=r;var f=1;var s=this[e+--n];while(n>0&&(f*=256)){s+=this[e+--n]*f}f*=128;if(s>=f)s-=Math.pow(2,8*r);return s};Buffer.prototype.readInt8=function t(e,r){if(!r)checkOffset(e,1,this.length);if(!(this[e]&128))return this[e];return(255-this[e]+1)*-1};Buffer.prototype.readInt16LE=function t(e,r){if(!r)checkOffset(e,2,this.length);var i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i};Buffer.prototype.readInt16BE=function t(e,r){if(!r)checkOffset(e,2,this.length);var i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i};Buffer.prototype.readInt32LE=function t(e,r){if(!r)checkOffset(e,4,this.length);return this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};Buffer.prototype.readInt32BE=function t(e,r){if(!r)checkOffset(e,4,this.length);return this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};Buffer.prototype.readFloatLE=function t(e,r){if(!r)checkOffset(e,4,this.length);return read(this,e,true,23,4)};Buffer.prototype.readFloatBE=function t(e,r){if(!r)checkOffset(e,4,this.length);return read(this,e,false,23,4)};Buffer.prototype.readDoubleLE=function t(e,r){if(!r)checkOffset(e,8,this.length);return read(this,e,true,52,8)};Buffer.prototype.readDoubleBE=function t(e,r){if(!r)checkOffset(e,8,this.length);return read(this,e,false,52,8)};function checkInt(t,e,r,i,n,f){if(!internalIsBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<f)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function t(e,r,i,n){e=+e;r=r|0;i=i|0;if(!n){var f=Math.pow(2,8*i)-1;checkInt(this,e,r,i,f,0)}var s=1;var u=0;this[r]=e&255;while(++u<i&&(s*=256)){this[r+u]=e/s&255}return r+i};Buffer.prototype.writeUIntBE=function t(e,r,i,n){e=+e;r=r|0;i=i|0;if(!n){var f=Math.pow(2,8*i)-1;checkInt(this,e,r,i,f,0)}var s=i-1;var u=1;this[r+s]=e&255;while(--s>=0&&(u*=256)){this[r+s]=e/u&255}return r+i};Buffer.prototype.writeUInt8=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)e=Math.floor(e);this[r]=e&255;return r+1};function objectWriteUInt16(t,e,r,i){if(e<0)e=65535+e+1;for(var n=0,f=Math.min(t.length-r,2);n<f;++n){t[r+n]=(e&255<<8*(i?n:1-n))>>>(i?n:1-n)*8}}Buffer.prototype.writeUInt16LE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e&255;this[r+1]=e>>>8}else{objectWriteUInt16(this,e,r,true)}return r+2};Buffer.prototype.writeUInt16BE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e>>>8;this[r+1]=e&255}else{objectWriteUInt16(this,e,r,false)}return r+2};function objectWriteUInt32(t,e,r,i){if(e<0)e=4294967295+e+1;for(var n=0,f=Math.min(t.length-r,4);n<f;++n){t[r+n]=e>>>(i?n:3-n)*8&255}}Buffer.prototype.writeUInt32LE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[r+3]=e>>>24;this[r+2]=e>>>16;this[r+1]=e>>>8;this[r]=e&255}else{objectWriteUInt32(this,e,r,true)}return r+4};Buffer.prototype.writeUInt32BE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e>>>24;this[r+1]=e>>>16;this[r+2]=e>>>8;this[r+3]=e&255}else{objectWriteUInt32(this,e,r,false)}return r+4};Buffer.prototype.writeIntLE=function t(e,r,i,n){e=+e;r=r|0;if(!n){var f=Math.pow(2,8*i-1);checkInt(this,e,r,i,f-1,-f)}var s=0;var u=1;var o=0;this[r]=e&255;while(++s<i&&(u*=256)){if(e<0&&o===0&&this[r+s-1]!==0){o=1}this[r+s]=(e/u>>0)-o&255}return r+i};Buffer.prototype.writeIntBE=function t(e,r,i,n){e=+e;r=r|0;if(!n){var f=Math.pow(2,8*i-1);checkInt(this,e,r,i,f-1,-f)}var s=i-1;var u=1;var o=0;this[r+s]=e&255;while(--s>=0&&(u*=256)){if(e<0&&o===0&&this[r+s+1]!==0){o=1}this[r+s]=(e/u>>0)-o&255}return r+i};Buffer.prototype.writeInt8=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)e=Math.floor(e);if(e<0)e=255+e+1;this[r]=e&255;return r+1};Buffer.prototype.writeInt16LE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e&255;this[r+1]=e>>>8}else{objectWriteUInt16(this,e,r,true)}return r+2};Buffer.prototype.writeInt16BE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e>>>8;this[r+1]=e&255}else{objectWriteUInt16(this,e,r,false)}return r+2};Buffer.prototype.writeInt32LE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e&255;this[r+1]=e>>>8;this[r+2]=e>>>16;this[r+3]=e>>>24}else{objectWriteUInt32(this,e,r,true)}return r+4};Buffer.prototype.writeInt32BE=function t(e,r,i){e=+e;r=r|0;if(!i)checkInt(this,e,r,4,2147483647,-2147483648);if(e<0)e=4294967295+e+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[r]=e>>>24;this[r+1]=e>>>16;this[r+2]=e>>>8;this[r+3]=e&255}else{objectWriteUInt32(this,e,r,false)}return r+4};function checkIEEE754(t,e,r,i,n,f){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,e,r,i,n){if(!n){checkIEEE754(t,e,r,4)}write(t,e,r,i,23,4);return r+4}Buffer.prototype.writeFloatLE=function t(e,r,i){return writeFloat(this,e,r,true,i)};Buffer.prototype.writeFloatBE=function t(e,r,i){return writeFloat(this,e,r,false,i)};function writeDouble(t,e,r,i,n){if(!n){checkIEEE754(t,e,r,8)}write(t,e,r,i,52,8);return r+8}Buffer.prototype.writeDoubleLE=function t(e,r,i){return writeDouble(this,e,r,true,i)};Buffer.prototype.writeDoubleBE=function t(e,r,i){return writeDouble(this,e,r,false,i)};Buffer.prototype.copy=function t(e,r,i,n){if(!i)i=0;if(!n&&n!==0)n=this.length;if(r>=e.length)r=e.length;if(!r)r=0;if(n>0&&n<i)n=i;if(n===i)return 0;if(e.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(e.length-r<n-i){n=e.length-r+i}var f=n-i;var s;if(this===e&&i<r&&r<n){for(s=f-1;s>=0;--s){e[s+r]=this[s+i]}}else if(f<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(s=0;s<f;++s){e[s+r]=this[s+i]}}else{Uint8Array.prototype.set.call(e,this.subarray(i,i+f),r)}return f};Buffer.prototype.fill=function t(e,r,i,n){if(typeof e==="string"){if(typeof r==="string"){n=r;r=0;i=this.length}else if(typeof i==="string"){n=i;i=this.length}if(e.length===1){var f=e.charCodeAt(0);if(f<256){e=f}}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!Buffer.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}}else if(typeof e==="number"){e=e&255}if(r<0||this.length<r||this.length<i){throw new RangeError("Out of range index")}if(i<=r){return this}r=r>>>0;i=i===undefined?this.length:i>>>0;if(!e)e=0;var s;if(typeof e==="number"){for(s=r;s<i;++s){this[s]=e}}else{var u=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,n).toString());var o=u.length;for(s=0;s<i-r;++s){this[s+r]=u[s%o]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(t){t=stringtrim(t).replace(INVALID_BASE64_RE,"");if(t.length<2)return"";while(t.length%4!==0){t=t+"="}return t}function stringtrim(t){if(t.trim)return t.trim();return t.replace(/^\s+|\s+$/g,"")}function toHex(t){if(t<16)return"0"+t.toString(16);return t.toString(16)}function utf8ToBytes(t,e){e=e||Infinity;var r;var i=t.length;var n=null;var f=[];for(var s=0;s<i;++s){r=t.charCodeAt(s);if(r>55295&&r<57344){if(!n){if(r>56319){if((e-=3)>-1)f.push(239,191,189);continue}else if(s+1===i){if((e-=3)>-1)f.push(239,191,189);continue}n=r;continue}if(r<56320){if((e-=3)>-1)f.push(239,191,189);n=r;continue}r=(n-55296<<10|r-56320)+65536}else if(n){if((e-=3)>-1)f.push(239,191,189)}n=null;if(r<128){if((e-=1)<0)break;f.push(r)}else if(r<2048){if((e-=2)<0)break;f.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;f.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return f}function asciiToBytes(t){var e=[];for(var r=0;r<t.length;++r){e.push(t.charCodeAt(r)&255)}return e}function utf16leToBytes(t,e){var r,i,n;var f=[];for(var s=0;s<t.length;++s){if((e-=2)<0)break;r=t.charCodeAt(s);i=r>>8;n=r%256;f.push(n);f.push(i)}return f}function base64ToBytes(t){return toByteArray(base64clean(t))}function blitBuffer(t,e,r,i){for(var n=0;n<i;++n){if(n+r>=e.length||n>=t.length)break;e[n+r]=t[n]}return n}function isnan(t){return t!==t}function isBuffer(t){return t!=null&&(!!t._isBuffer||isFastBuffer(t)||isSlowBuffer(t))}function isFastBuffer(t){return!!t.constructor&&typeof t.constructor.isBuffer==="function"&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return typeof t.readFloatLE==="function"&&typeof t.slice==="function"&&isFastBuffer(t.slice(0,0))}var Context=function(){function t(t,e){this.code="";this.scopes=[["vars"]];this.bitFields=[];this.tmpVariableCount=0;this.references=new Map;this.imports=[];this.reverseImports=new Map;this.useContextVariables=false;this.importPath=t;this.useContextVariables=e}t.prototype.generateVariable=function(t){var e=__spreadArray([],this.scopes[this.scopes.length-1],true);if(t){e.push(t)}return e.join(".")};t.prototype.generateOption=function(t){switch(typeof t){case"number":return t.toString();case"string":return this.generateVariable(t);case"function":return"".concat(this.addImport(t),".call(").concat(this.generateVariable(),", vars)")}};t.prototype.generateError=function(t){this.pushCode("throw new Error(".concat(t,");"))};t.prototype.generateTmpVariable=function(){return"$tmp"+this.tmpVariableCount++};t.prototype.pushCode=function(t){this.code+=t+"\n"};t.prototype.pushPath=function(t){if(t){this.scopes[this.scopes.length-1].push(t)}};t.prototype.popPath=function(t){if(t){this.scopes[this.scopes.length-1].pop()}};t.prototype.pushScope=function(t){this.scopes.push([t])};t.prototype.popScope=function(){this.scopes.pop()};t.prototype.addImport=function(t){if(!this.importPath)return"(".concat(t,")");var e=this.reverseImports.get(t);if(!e){e=this.imports.push(t)-1;this.reverseImports.set(t,e)}return"".concat(this.importPath,"[").concat(e,"]")};t.prototype.addReference=function(t){if(!this.references.has(t)){this.references.set(t,{resolved:false,requested:false})}};t.prototype.markResolved=function(t){var e=this.references.get(t);if(e){e.resolved=true}};t.prototype.markRequested=function(t){var e=this;t.forEach((function(t){var r=e.references.get(t);if(r){r.requested=true}}))};t.prototype.getUnresolvedReferences=function(){return Array.from(this.references).filter((function(t){var e=t[0],r=t[1];return!r.resolved&&!r.requested})).map((function(t){var e=t[0],r=t[1];return e}))};return t}();var aliasRegistry=new Map;var FUNCTION_PREFIX="___parser_";var PRIMITIVE_SIZES={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8};var PRIMITIVE_NAMES={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"};var PRIMITIVE_LITTLE_ENDIANS={uint8:false,uint16le:true,uint16be:false,uint32le:true,uint32be:false,int8:false,int16le:true,int16be:false,int32le:true,int32be:false,int64be:false,int64le:true,uint64be:false,uint64le:true,floatle:true,floatbe:false,doublele:true,doublebe:false};var Parser=function(){function t(){this.varName="";this.type="";this.options={};this.endian="be";this.useContextVariables=false}t.start=function(){return new t};t.prototype.primitiveGenerateN=function(t,e){var r=PRIMITIVE_NAMES[t];var i=PRIMITIVE_LITTLE_ENDIANS[t];e.pushCode("".concat(e.generateVariable(this.varName)," = dataView.get").concat(r,"(offset, ").concat(i,");"));e.pushCode("offset += ".concat(PRIMITIVE_SIZES[t],";"))};t.prototype.primitiveN=function(t,e,r){return this.setNextParser(t,e,r)};t.prototype.useThisEndian=function(t){return t+this.endian.toLowerCase()};t.prototype.uint8=function(t,e){if(e===void 0){e={}}return this.primitiveN("uint8",t,e)};t.prototype.uint16=function(t,e){if(e===void 0){e={}}return this.primitiveN(this.useThisEndian("uint16"),t,e)};t.prototype.uint16le=function(t,e){if(e===void 0){e={}}return this.primitiveN("uint16le",t,e)};t.prototype.uint16be=function(t,e){if(e===void 0){e={}}return this.primitiveN("uint16be",t,e)};t.prototype.uint32=function(t,e){if(e===void 0){e={}}return this.primitiveN(this.useThisEndian("uint32"),t,e)};t.prototype.uint32le=function(t,e){if(e===void 0){e={}}return this.primitiveN("uint32le",t,e)};t.prototype.uint32be=function(t,e){if(e===void 0){e={}}return this.primitiveN("uint32be",t,e)};t.prototype.int8=function(t,e){if(e===void 0){e={}}return this.primitiveN("int8",t,e)};t.prototype.int16=function(t,e){if(e===void 0){e={}}return this.primitiveN(this.useThisEndian("int16"),t,e)};t.prototype.int16le=function(t,e){if(e===void 0){e={}}return this.primitiveN("int16le",t,e)};t.prototype.int16be=function(t,e){if(e===void 0){e={}}return this.primitiveN("int16be",t,e)};t.prototype.int32=function(t,e){if(e===void 0){e={}}return this.primitiveN(this.useThisEndian("int32"),t,e)};t.prototype.int32le=function(t,e){if(e===void 0){e={}}return this.primitiveN("int32le",t,e)};t.prototype.int32be=function(t,e){if(e===void 0){e={}}return this.primitiveN("int32be",t,e)};t.prototype.bigIntVersionCheck=function(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")};t.prototype.int64=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("int64"),t,e)};t.prototype.int64be=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN("int64be",t,e)};t.prototype.int64le=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN("int64le",t,e)};t.prototype.uint64=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN(this.useThisEndian("uint64"),t,e)};t.prototype.uint64be=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN("uint64be",t,e)};t.prototype.uint64le=function(t,e){if(e===void 0){e={}}this.bigIntVersionCheck();return this.primitiveN("uint64le",t,e)};t.prototype.floatle=function(t,e){if(e===void 0){e={}}return this.primitiveN("floatle",t,e)};t.prototype.floatbe=function(t,e){if(e===void 0){e={}}return this.primitiveN("floatbe",t,e)};t.prototype.doublele=function(t,e){if(e===void 0){e={}}return this.primitiveN("doublele",t,e)};t.prototype.doublebe=function(t,e){if(e===void 0){e={}}return this.primitiveN("doublebe",t,e)};t.prototype.bitN=function(t,e,r){r.length=t;return this.setNextParser("bit",e,r)};t.prototype.bit1=function(t,e){if(e===void 0){e={}}return this.bitN(1,t,e)};t.prototype.bit2=function(t,e){if(e===void 0){e={}}return this.bitN(2,t,e)};t.prototype.bit3=function(t,e){if(e===void 0){e={}}return this.bitN(3,t,e)};t.prototype.bit4=function(t,e){if(e===void 0){e={}}return this.bitN(4,t,e)};t.prototype.bit5=function(t,e){if(e===void 0){e={}}return this.bitN(5,t,e)};t.prototype.bit6=function(t,e){if(e===void 0){e={}}return this.bitN(6,t,e)};t.prototype.bit7=function(t,e){if(e===void 0){e={}}return this.bitN(7,t,e)};t.prototype.bit8=function(t,e){if(e===void 0){e={}}return this.bitN(8,t,e)};t.prototype.bit9=function(t,e){if(e===void 0){e={}}return this.bitN(9,t,e)};t.prototype.bit10=function(t,e){if(e===void 0){e={}}return this.bitN(10,t,e)};t.prototype.bit11=function(t,e){if(e===void 0){e={}}return this.bitN(11,t,e)};t.prototype.bit12=function(t,e){if(e===void 0){e={}}return this.bitN(12,t,e)};t.prototype.bit13=function(t,e){if(e===void 0){e={}}return this.bitN(13,t,e)};t.prototype.bit14=function(t,e){if(e===void 0){e={}}return this.bitN(14,t,e)};t.prototype.bit15=function(t,e){if(e===void 0){e={}}return this.bitN(15,t,e)};t.prototype.bit16=function(t,e){if(e===void 0){e={}}return this.bitN(16,t,e)};t.prototype.bit17=function(t,e){if(e===void 0){e={}}return this.bitN(17,t,e)};t.prototype.bit18=function(t,e){if(e===void 0){e={}}return this.bitN(18,t,e)};t.prototype.bit19=function(t,e){if(e===void 0){e={}}return this.bitN(19,t,e)};t.prototype.bit20=function(t,e){if(e===void 0){e={}}return this.bitN(20,t,e)};t.prototype.bit21=function(t,e){if(e===void 0){e={}}return this.bitN(21,t,e)};t.prototype.bit22=function(t,e){if(e===void 0){e={}}return this.bitN(22,t,e)};t.prototype.bit23=function(t,e){if(e===void 0){e={}}return this.bitN(23,t,e)};t.prototype.bit24=function(t,e){if(e===void 0){e={}}return this.bitN(24,t,e)};t.prototype.bit25=function(t,e){if(e===void 0){e={}}return this.bitN(25,t,e)};t.prototype.bit26=function(t,e){if(e===void 0){e={}}return this.bitN(26,t,e)};t.prototype.bit27=function(t,e){if(e===void 0){e={}}return this.bitN(27,t,e)};t.prototype.bit28=function(t,e){if(e===void 0){e={}}return this.bitN(28,t,e)};t.prototype.bit29=function(t,e){if(e===void 0){e={}}return this.bitN(29,t,e)};t.prototype.bit30=function(t,e){if(e===void 0){e={}}return this.bitN(30,t,e)};t.prototype.bit31=function(t,e){if(e===void 0){e={}}return this.bitN(31,t,e)};t.prototype.bit32=function(t,e){if(e===void 0){e={}}return this.bitN(32,t,e)};t.prototype.namely=function(t){aliasRegistry.set(t,this);this.alias=t;return this};t.prototype.skip=function(t,e){if(e===void 0){e={}}return this.seek(t,e)};t.prototype.seek=function(t,e){if(e===void 0){e={}}if(e.assert){throw new Error("assert option on seek is not allowed.")}return this.setNextParser("seek","",{length:t})};t.prototype.string=function(t,e){if(!e.zeroTerminated&&!e.length&&!e.greedy){throw new Error("One of length, zeroTerminated, or greedy must be defined for string.")}if((e.zeroTerminated||e.length)&&e.greedy){throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.")}if(e.stripNull&&!(e.length||e.greedy)){throw new Error("length or greedy must be defined if stripNull is enabled.")}e.encoding=e.encoding||"utf8";return this.setNextParser("string",t,e)};t.prototype.buffer=function(t,e){if(!e.length&&!e.readUntil){throw new Error("length or readUntil must be defined for buffer.")}return this.setNextParser("buffer",t,e)};t.prototype.wrapped=function(t,e){if(typeof e!=="object"&&typeof t==="object"){e=t;t=""}if(!e||!e.wrapper||!e.type){throw new Error("Both wrapper and type must be defined for wrapped.")}if(!e.length&&!e.readUntil){throw new Error("length or readUntil must be defined for wrapped.")}return this.setNextParser("wrapper",t,e)};t.prototype.array=function(t,e){if(!e.readUntil&&!e.length&&!e.lengthInBytes){throw new Error("One of readUntil, length and lengthInBytes must be defined for array.")}if(!e.type){throw new Error("type is required for array.")}if(typeof e.type==="string"&&!aliasRegistry.has(e.type)&&!(e.type in PRIMITIVE_SIZES)){throw new Error('Array element type "'.concat(e.type,'" is unkown.'))}return this.setNextParser("array",t,e)};t.prototype.choice=function(t,e){if(typeof e!=="object"&&typeof t==="object"){e=t;t=""}if(!e){throw new Error("tag and choices are are required for choice.")}if(!e.tag){throw new Error("tag is requird for choice.")}if(!e.choices){throw new Error("choices is required for choice.")}for(var r in e.choices){var i=parseInt(r,10);var n=e.choices[i];if(isNaN(i)){throw new Error('Choice key "'.concat(r,'" is not a number.'))}if(typeof n==="string"&&!aliasRegistry.has(n)&&!(n in PRIMITIVE_SIZES)){throw new Error('Choice type "'.concat(n,'" is unkown.'))}}return this.setNextParser("choice",t,e)};t.prototype.nest=function(e,r){if(typeof r!=="object"&&typeof e==="object"){r=e;e=""}if(!r||!r.type){throw new Error("type is required for nest.")}if(!(r.type instanceof t)&&!aliasRegistry.has(r.type)){throw new Error("type must be a known parser name or a Parser object.")}if(!(r.type instanceof t)&&!e){throw new Error("type must be a Parser object if the variable name is omitted.")}return this.setNextParser("nest",e,r)};t.prototype.pointer=function(t,e){if(!e.offset){throw new Error("offset is required for pointer.")}if(!e.type){throw new Error("type is required for pointer.")}if(typeof e.type==="string"&&!(e.type in PRIMITIVE_SIZES)&&!aliasRegistry.has(e.type)){throw new Error('Pointer type "'.concat(e.type,'" is unkown.'))}return this.setNextParser("pointer",t,e)};t.prototype.saveOffset=function(t,e){if(e===void 0){e={}}return this.setNextParser("saveOffset",t,e)};t.prototype.endianness=function(t){switch(t.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this};t.prototype.endianess=function(t){return this.endianness(t)};t.prototype.useContextVars=function(t){if(t===void 0){t=true}this.useContextVariables=t;return this};t.prototype.create=function(t){if(!(t instanceof Function)){throw new Error("Constructor must be a Function object.")}this.constructorFn=t;return this};t.prototype.getContext=function(t){var e=new Context(t,this.useContextVariables);e.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);");if(!this.alias){this.addRawCode(e)}else{this.addAliasedCode(e);e.pushCode("return ".concat(FUNCTION_PREFIX+this.alias,"(0).result;"))}return e};t.prototype.getCode=function(){var t="imports";return this.getContext(t).code};t.prototype.addRawCode=function(t){t.pushCode("var offset = 0;");t.pushCode("var vars = ".concat(this.constructorFn?"new constructorFn()":"{}",";"));t.pushCode("vars.$parent = null;");t.pushCode("vars.$root = vars;");this.generate(t);this.resolveReferences(t);t.pushCode("delete vars.$parent;");t.pushCode("delete vars.$root;");t.pushCode("return vars;")};t.prototype.addAliasedCode=function(t){t.pushCode("function ".concat(FUNCTION_PREFIX+this.alias,"(offset, context) {"));t.pushCode("var vars = ".concat(this.constructorFn?"new constructorFn()":"{}",";"));t.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});");t.pushCode("vars = Object.assign(vars, ctx);");this.generate(t);t.markResolved(this.alias);this.resolveReferences(t);t.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });");t.pushCode("return { offset: offset, result: vars };");t.pushCode("}");return t};t.prototype.resolveReferences=function(t){var e=t.getUnresolvedReferences();t.markRequested(e);e.forEach((function(e){var r;(r=aliasRegistry.get(e))===null||r===void 0?void 0:r.addAliasedCode(t)}))};t.prototype.compile=function(){var t="imports";var e=this.getContext(t);this.compiled=new Function(t,"TextDecoder","return function (buffer, constructorFn) { ".concat(e.code," };"))(e.imports,TextDecoder)};t.prototype.sizeOf=function(){var e=NaN;if(Object.keys(PRIMITIVE_SIZES).indexOf(this.type)>=0){e=PRIMITIVE_SIZES[this.type]}else if(this.type==="string"&&typeof this.options.length==="number"){e=this.options.length}else if(this.type==="buffer"&&typeof this.options.length==="number"){e=this.options.length}else if(this.type==="array"&&typeof this.options.length==="number"){var r=NaN;if(typeof this.options.type==="string"){r=PRIMITIVE_SIZES[this.options.type]}else if(this.options.type instanceof t){r=this.options.type.sizeOf()}e=this.options.length*r}else if(this.type==="seek"){e=this.options.length}else if(this.type==="nest"){e=this.options.type.sizeOf()}else if(!this.type){e=0}if(this.next){e+=this.next.sizeOf()}return e};t.prototype.parse=function(t){if(!this.compiled){this.compile()}return this.compiled(t,this.constructorFn)};t.prototype.setNextParser=function(e,r,i){var n=new t;n.type=e;n.varName=r;n.options=i;n.endian=this.endian;if(this.head){this.head.next=n}else{this.next=n}this.head=n;return this};t.prototype.generate=function(t){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,t);break;case"bit":this.generateBit(t);break;case"string":this.generateString(t);break;case"buffer":this.generateBuffer(t);break;case"seek":this.generateSeek(t);break;case"nest":this.generateNest(t);break;case"array":this.generateArray(t);break;case"choice":this.generateChoice(t);break;case"pointer":this.generatePointer(t);break;case"saveOffset":this.generateSaveOffset(t);break;case"wrapper":this.generateWrapper(t);break}if(this.type!=="bit")this.generateAssert(t)}var e=t.generateVariable(this.varName);if(this.options.formatter&&this.type!=="bit"){this.generateFormatter(t,e,this.options.formatter)}return this.generateNext(t)};t.prototype.generateAssert=function(t){if(!this.options.assert){return}var e=t.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{var r=t.addImport(this.options.assert);t.pushCode("if (!".concat(r,".call(vars, ").concat(e,")) {"))}break;case"number":t.pushCode("if (".concat(this.options.assert," !== ").concat(e,") {"));break;case"string":t.pushCode("if (".concat(JSON.stringify(this.options.assert)," !== ").concat(e,") {"));break;default:throw new Error("assert option must be a string, number or a function.")}t.generateError('"Assertion error: '.concat(e,' is " + ').concat(JSON.stringify(this.options.assert.toString())));t.pushCode("}")};t.prototype.generateNext=function(t){if(this.next){t=this.next.generate(t)}return t};t.prototype.generateBit=function(t){var e=JSON.parse(JSON.stringify(this));e.options=this.options;e.generateAssert=this.generateAssert.bind(this);e.generateFormatter=this.generateFormatter.bind(this);e.varName=t.generateVariable(e.varName);t.bitFields.push(e);if(!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){var r=t.generateTmpVariable();t.pushCode("var ".concat(r," = 0;"));var i=function(e){if(e===void 0){e=0}var r=0;for(var i=e;i<t.bitFields.length;i++){var n=t.bitFields[i].options.length;if(r+n>32)break;r+=n}return r};var n=function(e){if(e<=8){t.pushCode("".concat(r," = dataView.getUint8(offset);"));e=8}else if(e<=16){t.pushCode("".concat(r," = dataView.getUint16(offset);"));e=16}else if(e<=24){t.pushCode("".concat(r," = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);"));e=24}else{t.pushCode("".concat(r," = dataView.getUint32(offset);"));e=32}t.pushCode("offset += ".concat(e/8,";"));return e};var f=0;var s=this.endian==="be";var u=0;var o=0;t.bitFields.forEach((function(e,a){var h=e.options.length;if(h>o){if(o){var c=-1>>>32-o;t.pushCode("".concat(e.varName," = (").concat(r," & 0x").concat(c.toString(16),") << ").concat(h-o,";"));h-=o}f=0;o=u=n(i(a)-o)}var l=s?u-f-h:f;var v=-1>>>32-h;t.pushCode("".concat(e.varName," ").concat(h<e.options.length?"|=":"="," ").concat(r," >> ").concat(l," & 0x").concat(v.toString(16),";"));if(e.options.length===32){t.pushCode("".concat(e.varName," >>>= 0"))}if(e.options.assert){e.generateAssert(t)}if(e.options.formatter){e.generateFormatter(t,e.varName,e.options.formatter)}f+=h;o-=h}));t.bitFields=[]}};t.prototype.generateSeek=function(t){var e=t.generateOption(this.options.length);t.pushCode("offset += ".concat(e,";"))};t.prototype.generateString=function(t){var e=t.generateVariable(this.varName);var r=t.generateTmpVariable();var i=this.options.encoding;var n=i.toLowerCase()==="hex";var f='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){var s=this.options.length;t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(dataView.getUint8(offset++) !== 0 && offset - ".concat(r," < ").concat(s,");"));var u="offset - ".concat(r," < ").concat(s," ? offset - 1 : offset");t.pushCode(n?"".concat(e," = Array.from(buffer.subarray(").concat(r,", ").concat(u,"), ").concat(f,").join('');"):"".concat(e," = new TextDecoder('").concat(i,"').decode(buffer.subarray(").concat(r,", ").concat(u,"));"))}else if(this.options.length){var s=t.generateOption(this.options.length);t.pushCode(n?"".concat(e," = Array.from(buffer.subarray(offset, offset + ").concat(s,"), ").concat(f,").join('');"):"".concat(e," = new TextDecoder('").concat(i,"').decode(buffer.subarray(offset, offset + ").concat(s,"));"));t.pushCode("offset += ".concat(s,";"))}else if(this.options.zeroTerminated){t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(dataView.getUint8(offset++) !== 0);");t.pushCode(n?"".concat(e," = Array.from(buffer.subarray(").concat(r,", offset - 1), ").concat(f,").join('');"):"".concat(e," = new TextDecoder('").concat(i,"').decode(buffer.subarray(").concat(r,", offset - 1));"))}else if(this.options.greedy){t.pushCode("var ".concat(r," = offset;"));t.pushCode("while(buffer.length > offset++);");t.pushCode(n?"".concat(e," = Array.from(buffer.subarray(").concat(r,", offset), ").concat(f,").join('');"):"".concat(e," = new TextDecoder('").concat(i,"').decode(buffer.subarray(").concat(r,", offset));"))}if(this.options.stripNull){t.pushCode("".concat(e," = ").concat(e,".replace(/\\x00+$/g, '')"))}};t.prototype.generateBuffer=function(t){var e=t.generateVariable(this.varName);if(typeof this.options.readUntil==="function"){var r=this.options.readUntil;var i=t.generateTmpVariable();var n=t.generateTmpVariable();t.pushCode("var ".concat(i," = offset;"));t.pushCode("var ".concat(n," = 0;"));t.pushCode("while (offset < buffer.length) {");t.pushCode("".concat(n," = dataView.getUint8(offset);"));var f=t.addImport(r);t.pushCode("if (".concat(f,".call(").concat(t.generateVariable(),", ").concat(n,", buffer.subarray(offset))) break;"));t.pushCode("offset += 1;");t.pushCode("}");t.pushCode("".concat(e," = buffer.subarray(").concat(i,", offset);"))}else if(this.options.readUntil==="eof"){t.pushCode("".concat(e," = buffer.subarray(offset);"))}else{var s=t.generateOption(this.options.length);t.pushCode("".concat(e," = buffer.subarray(offset, offset + ").concat(s,");"));t.pushCode("offset += ".concat(s,";"))}if(this.options.clone){t.pushCode("".concat(e," = buffer.constructor.from(").concat(e,");"))}};t.prototype.generateArray=function(e){var r=e.generateOption(this.options.length);var i=e.generateOption(this.options.lengthInBytes);var n=this.options.type;var f=e.generateTmpVariable();var s=e.generateVariable(this.varName);var u=e.generateTmpVariable();var o=this.options.key;var a=typeof o==="string";if(a){e.pushCode("".concat(s," = {};"))}else{e.pushCode("".concat(s," = [];"))}if(typeof this.options.readUntil==="function"){e.pushCode("do {")}else if(this.options.readUntil==="eof"){e.pushCode("for (var ".concat(f," = 0; offset < buffer.length; ").concat(f,"++) {"))}else if(i!==undefined){e.pushCode("for (var ".concat(f," = offset + ").concat(i,"; offset < ").concat(f,"; ) {"))}else{e.pushCode("for (var ".concat(f," = ").concat(r,"; ").concat(f," > 0; ").concat(f,"--) {"))}if(typeof n==="string"){if(!aliasRegistry.get(n)){var h=PRIMITIVE_NAMES[n];var c=PRIMITIVE_LITTLE_ENDIANS[n];e.pushCode("var ".concat(u," = dataView.get").concat(h,"(offset, ").concat(c,");"));e.pushCode("offset += ".concat(PRIMITIVE_SIZES[n],";"))}else{var l=e.generateTmpVariable();e.pushCode("var ".concat(l," = ").concat(FUNCTION_PREFIX+n,"(offset, {"));if(e.useContextVariables){var v=e.generateVariable();e.pushCode("$parent: ".concat(v,","));e.pushCode("$root: ".concat(v,".$root,"));if(!this.options.readUntil&&i===undefined){e.pushCode("$index: ".concat(r," - ").concat(f,","))}}e.pushCode("});");e.pushCode("var ".concat(u," = ").concat(l,".result; offset = ").concat(l,".offset;"));if(n!==this.alias)e.addReference(n)}}else if(n instanceof t){e.pushCode("var ".concat(u," = {};"));var v=e.generateVariable();e.pushScope(u);if(e.useContextVariables){e.pushCode("".concat(u,".$parent = ").concat(v,";"));e.pushCode("".concat(u,".$root = ").concat(v,".$root;"));if(!this.options.readUntil&&i===undefined){e.pushCode("".concat(u,".$index = ").concat(r," - ").concat(f,";"))}}n.generate(e);if(e.useContextVariables){e.pushCode("delete ".concat(u,".$parent;"));e.pushCode("delete ".concat(u,".$root;"));e.pushCode("delete ".concat(u,".$index;"))}e.popScope()}if(a){e.pushCode("".concat(s,"[").concat(u,".").concat(o,"] = ").concat(u,";"))}else{e.pushCode("".concat(s,".push(").concat(u,");"))}e.pushCode("}");if(typeof this.options.readUntil==="function"){var d=this.options.readUntil;var b=e.addImport(d);e.pushCode("while (!".concat(b,".call(").concat(e.generateVariable(),", ").concat(u,", buffer.subarray(offset)));"))}};t.prototype.generateChoiceCase=function(e,r,i){if(typeof i==="string"){var n=e.generateVariable(this.varName);if(!aliasRegistry.has(i)){var f=PRIMITIVE_NAMES[i];var s=PRIMITIVE_LITTLE_ENDIANS[i];e.pushCode("".concat(n," = dataView.get").concat(f,"(offset, ").concat(s,");"));e.pushCode("offset += ".concat(PRIMITIVE_SIZES[i]))}else{var u=e.generateTmpVariable();e.pushCode("var ".concat(u," = ").concat(FUNCTION_PREFIX+i,"(offset, {"));if(e.useContextVariables){e.pushCode("$parent: ".concat(n,".$parent,"));e.pushCode("$root: ".concat(n,".$root,"))}e.pushCode("});");e.pushCode("".concat(n," = ").concat(u,".result; offset = ").concat(u,".offset;"));if(i!==this.alias)e.addReference(i)}}else if(i instanceof t){e.pushPath(r);i.generate(e);e.popPath(r)}};t.prototype.generateChoice=function(t){var e=t.generateOption(this.options.tag);var r=t.generateVariable(this.varName);if(this.varName){t.pushCode("".concat(r," = {};"));if(t.useContextVariables){var i=t.generateVariable();t.pushCode("".concat(r,".$parent = ").concat(i,";"));t.pushCode("".concat(r,".$root = ").concat(i,".$root;"))}}t.pushCode("switch(".concat(e,") {"));for(var n in this.options.choices){var f=parseInt(n,10);var s=this.options.choices[f];t.pushCode("case ".concat(f,":"));this.generateChoiceCase(t,this.varName,s);t.pushCode("break;")}t.pushCode("default:");if(this.options.defaultChoice){this.generateChoiceCase(t,this.varName,this.options.defaultChoice)}else{t.generateError('"Met undefined tag value " + '.concat(e,' + " at choice"'))}t.pushCode("}");if(this.varName&&t.useContextVariables){t.pushCode("delete ".concat(r,".$parent;"));t.pushCode("delete ".concat(r,".$root;"))}};t.prototype.generateNest=function(e){var r=e.generateVariable(this.varName);if(this.options.type instanceof t){if(this.varName){e.pushCode("".concat(r," = {};"));if(e.useContextVariables){var i=e.generateVariable();e.pushCode("".concat(r,".$parent = ").concat(i,";"));e.pushCode("".concat(r,".$root = ").concat(i,".$root;"))}}e.pushPath(this.varName);this.options.type.generate(e);e.popPath(this.varName);if(this.varName&&e.useContextVariables){if(e.useContextVariables){e.pushCode("delete ".concat(r,".$parent;"));e.pushCode("delete ".concat(r,".$root;"))}}}else if(aliasRegistry.has(this.options.type)){var n=e.generateTmpVariable();e.pushCode("var ".concat(n," = ").concat(FUNCTION_PREFIX+this.options.type,"(offset, {"));if(e.useContextVariables){var i=e.generateVariable();e.pushCode("$parent: ".concat(i,","));e.pushCode("$root: ".concat(i,".$root,"))}e.pushCode("});");e.pushCode("".concat(r," = ").concat(n,".result; offset = ").concat(n,".offset;"));if(this.options.type!==this.alias){e.addReference(this.options.type)}}};t.prototype.generateWrapper=function(e){var r=e.generateVariable(this.varName);var i=e.generateTmpVariable();if(typeof this.options.readUntil==="function"){var n=this.options.readUntil;var f=e.generateTmpVariable();var s=e.generateTmpVariable();e.pushCode("var ".concat(f," = offset;"));e.pushCode("var ".concat(s," = 0;"));e.pushCode("while (offset < buffer.length) {");e.pushCode("".concat(s," = dataView.getUint8(offset);"));var u=e.addImport(n);e.pushCode("if (".concat(u,".call(").concat(e.generateVariable(),", ").concat(s,", buffer.subarray(offset))) break;"));e.pushCode("offset += 1;");e.pushCode("}");e.pushCode("".concat(i," = buffer.subarray(").concat(f,", offset);"))}else if(this.options.readUntil==="eof"){e.pushCode("".concat(i," = buffer.subarray(offset);"))}else{var o=e.generateOption(this.options.length);e.pushCode("".concat(i," = buffer.subarray(offset, offset + ").concat(o,");"));e.pushCode("offset += ".concat(o,";"))}if(this.options.clone){e.pushCode("".concat(i," = buffer.constructor.from(").concat(i,");"))}var a=e.generateTmpVariable();var h=e.generateTmpVariable();var c=e.generateTmpVariable();var l=e.addImport(this.options.wrapper);e.pushCode("".concat(i," = ").concat(l,".call(this, ").concat(i,").subarray(0);"));e.pushCode("var ".concat(a," = buffer;"));e.pushCode("var ".concat(h," = offset;"));e.pushCode("var ".concat(c," = dataView;"));e.pushCode("buffer = ".concat(i,";"));e.pushCode("offset = 0;");e.pushCode("dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);");if(this.options.type instanceof t){if(this.varName){e.pushCode("".concat(r," = {};"))}e.pushPath(this.varName);this.options.type.generate(e);e.popPath(this.varName)}else if(aliasRegistry.has(this.options.type)){var v=e.generateTmpVariable();e.pushCode("var ".concat(v," = ").concat(FUNCTION_PREFIX+this.options.type,"(0);"));e.pushCode("".concat(r," = ").concat(v,".result;"));if(this.options.type!==this.alias){e.addReference(this.options.type)}}e.pushCode("buffer = ".concat(a,";"));e.pushCode("dataView = ".concat(c,";"));e.pushCode("offset = ".concat(h,";"))};t.prototype.generateFormatter=function(t,e,r){if(typeof r==="function"){var i=t.addImport(r);t.pushCode("".concat(e," = ").concat(i,".call(").concat(t.generateVariable(),", ").concat(e,");"))}};t.prototype.generatePointer=function(e){var r=this.options.type;var i=e.generateOption(this.options.offset);var n=e.generateTmpVariable();var f=e.generateVariable(this.varName);e.pushCode("var ".concat(n," = offset;"));e.pushCode("offset = ".concat(i,";"));if(this.options.type instanceof t){e.pushCode("".concat(f," = {};"));if(e.useContextVariables){var s=e.generateVariable();e.pushCode("".concat(f,".$parent = ").concat(s,";"));e.pushCode("".concat(f,".$root = ").concat(s,".$root;"))}e.pushPath(this.varName);this.options.type.generate(e);e.popPath(this.varName);if(e.useContextVariables){e.pushCode("delete ".concat(f,".$parent;"));e.pushCode("delete ".concat(f,".$root;"))}}else if(aliasRegistry.has(this.options.type)){var u=e.generateTmpVariable();e.pushCode("var ".concat(u," = ").concat(FUNCTION_PREFIX+this.options.type,"(offset, {"));if(e.useContextVariables){var s=e.generateVariable();e.pushCode("$parent: ".concat(s,","));e.pushCode("$root: ".concat(s,".$root,"))}e.pushCode("});");e.pushCode("".concat(f," = ").concat(u,".result; offset = ").concat(u,".offset;"));if(this.options.type!==this.alias){e.addReference(this.options.type)}}else if(Object.keys(PRIMITIVE_SIZES).indexOf(this.options.type)>=0){var o=PRIMITIVE_NAMES[r];var a=PRIMITIVE_LITTLE_ENDIANS[r];e.pushCode("".concat(f," = dataView.get").concat(o,"(offset, ").concat(a,");"));e.pushCode("offset += ".concat(PRIMITIVE_SIZES[r],";"))}e.pushCode("offset = ".concat(n,";"))};t.prototype.generateSaveOffset=function(t){var e=t.generateVariable(this.varName);t.pushCode("".concat(e," = offset"))};return t}();function newParser(){return(new Parser).endianess("little")}function componentHeaderParser(){var t=newParser().uint16("from").uint16("to");var e=newParser().uint16("R").uint16("G").uint16("B");var r=newParser().uint16("_chars").string("text",{length:"_chars"});return newParser().uint16("_name").string("name",{length:"_name"}).uint16("_format").string("format",{length:"_format"}).uint16("_points").uint16("_limbs").uint16("_colors").array("points",{type:r,formatter:function(t){return t.map((function(t){return t.text}))},length:"_points"}).array("limbs",{type:t,length:"_limbs"}).array("colors",{type:e,length:"_colors"})}function getHeaderParser(){var t=componentHeaderParser();return newParser().floatle("version").uint16("width").uint16("height").uint16("depth").uint16("_components").array("components",{type:t,length:"_components"}).saveOffset("headerLength")}function getBodyParserV0_0(t){var e=newParser().int16("id");t.components.forEach((function(t){var r=newParser();Array.from(t.format).forEach((function(t){r=r.floatle(t)}));e=e.array(t.name,{type:r,length:t._points})}));var r=newParser().uint16("_people").array("people",{type:e,length:"_people"});return newParser().seek(t.headerLength).uint16("fps").uint16("_frames").array("frames",{type:r,length:"_frames"})}function parseBodyV0_0(t,e){return getBodyParserV0_0(t).parse(e)}function parseBodyV0_1(t,e){var r=t.components.map((function(t){return t.points.length})).reduce((function(t,e){return t+e}),0);var i=Math.max.apply(Math,t.components.map((function(t){return t.format.length})))-1;var n=newParser().seek(t.headerLength).uint16("fps").uint16("_frames").uint16("_people");var f=n.parse(e);var s=function(t,r){var i=new DataView(e.buffer,e.byteOffset,e.length);var n=r;var f={data:new Float32Array(t),offset:0};for(var s=0;s<f.data.length;s++){var u=i.getFloat32(n,true);n+=4;f.data[s]=u}f.offset=n;return f};var u=s(f._frames*f._people*r*i,t.headerLength+6);var o=s(f._frames*f._people*r,u.offset);function a(e){var n=new Array(f._people);var s=function(s){var a={};n[s]=a;var h=0;t.components.forEach((function(t){a[t.name]=[];var n=function(n){var c=e*(f._people*r)+s*r;var l=c+h+n;var v={C:o.data[l]};__spreadArray([],t.format,true).forEach((function(t,e){if(t!=="C"){v[t]=u.data[l*i+e]}}));a[t.name].push(v)};for(var c=0;c<t.points.length;c++){n(c)}h+=t.points.length}))};for(var a=0;a<f._people;a++){s(a)}return{people:n}}var h=new Proxy({},{get:function(t,e){if(e==="length"){return f._frames}return a(e)}});return Object.assign(Object.assign({},f),{frames:h})}var headerParser=getHeaderParser();function parsePose(t){var e=headerParser.parse(t);var r;var i=Math.round(e.version*1e3)/1e3;switch(i){case 0:r=parseBodyV0_0(e,t);break;case.1:r=parseBodyV0_1(e,t);break;default:throw new Error("Parsing this body version is not implemented - "+e.version)}return{header:e,body:r}}var empty={};var fs=Object.freeze({__proto__:null,default:empty});var Pose=function(){function t(t,e){this.header=t;this.body=e}t.from=function(e){var r=parsePose(e);return new t(r.header,r.body)};t.fromLocal=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(i){r=undefined(e);return[2,t.from(r)]}))}))};t.fromRemote=function(e,r){return __awaiter(this,void 0,void 0,(function(){var i,n,f,s,u,o,a,h,c;return __generator(this,(function(l){switch(l.label){case 0:n={};if(r){n.signal=r.signal}return[4,fetch(e,n)];case 1:f=l.sent();if(!!f.ok)return[3,6];s=(i=f.statusText)!==null&&i!==void 0?i:String(f.status);l.label=2;case 2:l.trys.push([2,4,,5]);return[4,f.json()];case 3:u=l.sent();s=u.message;return[3,5];case 4:o=l.sent();return[3,5];case 5:throw new Error(s);case 6:c=(h=Buffer).from;return[4,f.arrayBuffer()];case 7:a=c.apply(h,[l.sent()]);return[2,t.from(a)]}}))}))};return t}();var PoseRenderer=function(){function t(t){this.viewer=t}t.prototype.x=function(t){var e=t*(this.viewer.elWidth-2*this.viewer.elPadding.width);return e/this.viewer.pose.header.width+this.viewer.elPadding.width};t.prototype.y=function(t){var e=t*(this.viewer.elHeight-2*this.viewer.elPadding.height);return e/this.viewer.pose.header.height+this.viewer.elPadding.height};t.prototype.isJointValid=function(t){return t.C>0};t.prototype.renderJoints=function(t,e){var r=this;return t.filter(this.isJointValid.bind(this)).map((function(t,i){return r.renderJoint(i,t,e[i%e.length])}))};t.prototype.renderLimbs=function(t,e,r){var i=this;return t.map((function(t){var n=t.from,f=t.to;var s=e[n];var u=e[f];if(!i.isJointValid(s)||!i.isJointValid(u)){return""}var o=r[n%r.length];var a=r[f%r.length];var h={R:(o.R+a.R)/2,G:(o.G+a.G)/2,B:(o.B+a.B)/2};return i.renderLimb(s,u,h)}))};t.prototype.renderFrame=function(t){var e=this;return t.people.map((function(t){return e.viewer.pose.header.components.map((function(r){var i=t[r.name];return[e.renderJoints(i,r.colors),e.renderLimbs(r.limbs,i,r.colors)]}))}))};return t}();var SVGPoseRenderer=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.renderJoint=function(t,e,r){var i=r.R,n=r.G,f=r.B;return h("circle",{cx:e.X,cy:e.Y,r:4,class:"joint draggable",style:{fill:"rgb(".concat(i,", ").concat(n,", ").concat(f,")"),opacity:String(e.C)},"data-id":t})};e.prototype.renderLimb=function(t,e,r){var i=r.R,n=r.G,f=r.B;return h("line",{x1:t.X,y1:t.Y,x2:e.X,y2:e.Y,style:{stroke:"rgb(".concat(i,", ").concat(n,", ").concat(f,")"),opacity:String((t.C+e.C)/2)}})};e.prototype.render=function(t){var e="0 0 ".concat(this.viewer.pose.header.width," ").concat(this.viewer.pose.header.height);return h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:e,width:this.viewer.elWidth,height:this.viewer.elHeight},h("g",null,this.renderFrame(t)))};return e}(PoseRenderer);var CanvasPoseRenderer=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.renderJoint=function(t,e,r){var i=r.R,n=r.G,f=r.B;this.ctx.strokeStyle="rgba(0, 0, 0, 0)";this.ctx.fillStyle="rgba(".concat(i,", ").concat(n,", ").concat(f,", ").concat(e.C,")");var s=Math.round(this.thickness/3);this.ctx.beginPath();this.ctx.arc(this.x(e.X),this.y(e.Y),s,0,2*Math.PI);this.ctx.fill();this.ctx.stroke()};e.prototype.renderLimb=function(t,e,r){var i=r.R,n=r.G,f=r.B;this.ctx.lineWidth=this.thickness*5/4;this.ctx.strokeStyle="rgba(".concat(i,", ").concat(n,", ").concat(f,", ").concat((t.C+e.C)/2,")");this.ctx.beginPath();this.ctx.moveTo(this.x(t.X),this.y(t.Y));this.ctx.lineTo(this.x(e.X),this.y(e.Y));this.ctx.stroke()};e.prototype.render=function(t){var e=this;var r=function(){var r;var i=e.viewer.element.shadowRoot.querySelector("canvas");if(i){i.width=e.viewer.elWidth;i.height=e.viewer.elHeight;e.ctx=i.getContext("2d");if(e.viewer.background){e.ctx.fillStyle=e.viewer.background;e.ctx.fillRect(0,0,i.width,i.height)}else{e.ctx.clearRect(0,0,i.width,i.height)}var n=e.viewer.elWidth-2*e.viewer.elPadding.width;var f=e.viewer.elHeight-2*e.viewer.elPadding.height;e.thickness=(r=e.viewer.thickness)!==null&&r!==void 0?r:Math.round(Math.sqrt(n*f)/150);e.renderFrame(t)}else{throw new Error("Canvas isn't available before first render")}};try{r()}catch(t){requestAnimationFrame(r)}return h("canvas",{width:this.viewer.elWidth,height:this.viewer.elHeight})};return e}(PoseRenderer);var poseViewerCss=":host{display:inline-block}svg,canvas{max-width:100%}svg circle{stroke:black;stroke-width:1px;opacity:0.8}svg line{stroke-width:8px;opacity:0.8;stroke:black}canvas{display:block}";var PoseViewer=function(){function t(t){registerInstance(this,t);this.canplaythrough$=createEvent(this,"canplaythrough$",7);this.ended$=createEvent(this,"ended$",7);this.loadeddata$=createEvent(this,"loadeddata$",7);this.loadedmetadata$=createEvent(this,"loadedmetadata$",7);this.loadstart$=createEvent(this,"loadstart$",7);this.pause$=createEvent(this,"pause$",7);this.play$=createEvent(this,"play$",7);this.firstRender$=createEvent(this,"firstRender$",7);this.render$=createEvent(this,"render$",7);this.hasRendered=false;this.src=undefined;this.svg=false;this.width=null;this.height=null;this.aspectRatio=null;this.padding=null;this.thickness=null;this.background=null;this.loop=false;this.autoplay=true;this.playbackRate=1;this.currentTime=NaN;this.duration=NaN;this.ended=false;this.paused=true;this.readyState=0;this.error=undefined}t.prototype.componentWillLoad=function(){this.renderer=this.svg?new SVGPoseRenderer(this):new CanvasPoseRenderer(this);return this.srcChange()};t.prototype.componentDidLoad=function(){this.resizeObserver=new ResizeObserver(this.setDimensions.bind(this));this.resizeObserver.observe(this.element)};t.prototype.getRemotePose=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:if(this.fetchAbortController){this.fetchAbortController.abort()}this.fetchAbortController=new AbortController;t=this;return[4,Pose.fromRemote(this.src,this.fetchAbortController)];case 1:t.pose=e.sent();return[2]}}))}))};t.prototype.initPose=function(){this.setDimensions();this.loadedmetadata$.emit();this.loadeddata$.emit();this.canplaythrough$.emit();this.duration=(this.pose.body.frames.length-1)/this.pose.body.fps;this.currentTime=0;if(this.autoplay){this.play()}};t.prototype.srcChange=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:if(this.src===this.lastSrc){return[2]}this.lastSrc=this.src;this.clearInterval();this.setDimensions();delete this.pose;this.currentTime=NaN;this.duration=NaN;this.hasRendered=false;if(!this.src){return[2]}this.ended=false;this.loadstart$.emit();this.error=null;e.label=1;case 1:e.trys.push([1,3,,4]);return[4,this.getRemotePose()];case 2:e.sent();this.initPose();this.error=null;return[3,4];case 3:t=e.sent();console.error("PoseViewer error",t);this.error=t;return[3,4];case 4:return[2]}}))}))};t.prototype.setDimensions=function(){this.elPadding={width:0,height:0};if(!this.pose){this.elWidth=0;this.elHeight=0;return}if(!this.width&&!this.height){this.elWidth=this.pose.header.width;this.elHeight=this.pose.header.height;return}var t=this.element.getBoundingClientRect();var e=function(t,e){return t.endsWith("px")?Number(t.slice(0,-2)):t.endsWith("%")?e*t.slice(0,-1)/100:Number(t)};if(this.width&&this.height){this.elWidth=e(this.width,t.width);this.elHeight=e(this.height,t.height)}else if(this.width){this.elWidth=e(this.width,t.width);this.elHeight=this.aspectRatio?this.elWidth*this.aspectRatio:this.pose.header.height/this.pose.header.width*this.elWidth}else if(this.height){this.elHeight=e(this.height,t.height);this.elWidth=this.aspectRatio?this.elHeight/this.aspectRatio:this.pose.header.width/this.pose.header.height*this.elHeight}if(this.padding){this.elPadding.width+=e(this.padding,this.elWidth);this.elPadding.height+=e(this.padding,this.elHeight)}var r=this.elWidth-this.elPadding.width*2;var i=this.elHeight-this.elPadding.height*2;var n=r/i;var f=this.pose.header.width/this.pose.header.height;if(f>n){this.elPadding.height+=(f-n)*i/2}else{this.elPadding.width+=(1/f-1/n)*r/2}};t.prototype.syncMedia=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r;var i=this;return __generator(this,(function(n){this.media=t;this.media.addEventListener("pause",this.pause.bind(this));this.media.addEventListener("play",this.play.bind(this));e=function(){return i.currentTime=i.frameTime(i.media.currentTime)};this.media.addEventListener("seek",e);this.media.addEventListener("timeupdate",e);r=function(){return i.playbackRate=i.media.playbackRate};this.media.addEventListener("ratechange",r);r();this.clearInterval();if(this.media.paused){this.pause()}else{this.play()}return[2]}))}))};t.prototype.getPose=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.pose]}))}))};t.prototype.nextFrame=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){t=this.currentTime+1/this.pose.body.fps;if(t>this.duration){if(this.loop){this.currentTime=t%this.duration}else{this.ended$.emit();this.ended=true}}else{this.currentTime=t}return[2]}))}))};t.prototype.frameTime=function(t){if(!this.pose){return 0}return Math.floor(t*this.pose.body.fps)/this.pose.body.fps};t.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;var r=this;return __generator(this,(function(i){if(!this.paused){this.clearInterval()}this.paused=false;this.play$.emit();if(this.currentTime>this.duration){this.currentTime=0}t=1e3/(this.pose.body.fps*this.playbackRate);if(this.media){this.loopInterval=setInterval((function(){return r.currentTime=r.frameTime(r.media.currentTime)}),t)}else{e=Date.now()/1e3;this.loopInterval=setInterval((function(){var t=Date.now()/1e3;r.currentTime+=(t-e)*r.playbackRate;e=t;if(r.currentTime>r.duration){if(r.loop){r.currentTime=r.currentTime%r.duration}else{r.ended$.emit();r.ended=true;r.clearInterval()}}}),t)}return[2]}))}))};t.prototype.pause=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.paused=true;this.pause$.emit();this.clearInterval();return[2]}))}))};t.prototype.clearInterval=function(){if(this.loopInterval){clearInterval(this.loopInterval)}};t.prototype.disconnectedCallback=function(){this.clearInterval()};t.prototype.render=function(){var t=this;if(this.error){return this.error.name!=="AbortError"?this.error.message:""}if(!this.pose||isNaN(this.currentTime)||!this.renderer){return""}var e=this.currentTime>this.duration?this.duration:this.currentTime;var r=Math.floor(e*this.pose.body.fps);var i=this.pose.body.frames[r];var n=this.renderer.render(i);if(!this.hasRendered){requestAnimationFrame((function(){t.hasRendered=true;t.firstRender$.emit()}))}requestAnimationFrame((function(){return t.render$.emit()}));return h(Host,null,n)};Object.defineProperty(t.prototype,"element",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{src:["srcChange"]}},enumerable:false,configurable:true});return t}();PoseViewer.style=poseViewerCss;export{PoseViewer as pose_viewer};
//# sourceMappingURL=pose-viewer.entry.js.map